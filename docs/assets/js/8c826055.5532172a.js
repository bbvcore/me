"use strict";(self.webpackChunkmydocs=self.webpackChunkmydocs||[]).push([[4222],{2043:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"Ciberseguridad/MV/Hack-MV/hack-mv","title":"Hack MV","description":"Procedo a la creaci\xf3n de una m\xe1quina virtual para ejercicios de ciberseguridad, la cual ser\xe1 un OS GNU/Linux del ecosistema RHEL para salir de mi \xe1rea de confort Debian, m\xe1s concretamente AlmaLinux 8.10.","source":"@site/docs/Ciberseguridad/MV/Hack-MV/hack-mv.md","sourceDirName":"Ciberseguridad/MV/Hack-MV","slug":"/Ciberseguridad/MV/Hack-MV/","permalink":"/me/docs/docs/Ciberseguridad/MV/Hack-MV/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Ciberseguridad/MV/Hack-MV/hack-mv.md","tags":[],"version":"current","frontMatter":{"title":"Hack MV"},"sidebar":"tutorialSidebar","previous":{"title":"Suricata","permalink":"/me/docs/docs/Ciberseguridad/IDPS/suricata"},"next":{"title":"Menu SO","permalink":"/me/docs/docs/Ciberseguridad/Security Onion/intro"}}');var i=r(4848),s=r(8453);const o={title:"Hack MV"},d="Hack MV",l={},c=[{value:"Usuarios del OS",id:"usuarios-del-os",level:2},{value:"Sudoers",id:"sudoers",level:3},{value:"Jaula",id:"jaula",level:3},{value:"Servidor vsFTPD",id:"servidor-vsftpd",level:2},{value:"Servidor SSH",id:"servidor-ssh",level:2},{value:"Servidores web",id:"servidores-web",level:2},{value:"Instalaci\xf3n de Apache",id:"instalaci\xf3n-de-apache",level:3},{value:"Subdirectorios",id:"subdirectorios",level:4},{value:"Permisos",id:"permisos",level:4},{value:"Ficheros index",id:"ficheros-index",level:4},{value:"Contenido de los servicios",id:"contenido-de-los-servicios",level:4},{value:"Modificar fichero /etc/hosts",id:"modificar-fichero-etchosts",level:4},{value:"PHP y MariaDB",id:"php-y-mariadb",level:2},{value:"Instalaci\xf3n de PHP",id:"instalaci\xf3n-de-php",level:3},{value:"Verificaci\xf3n de la instalaci\xf3n",id:"verificaci\xf3n-de-la-instalaci\xf3n",level:4},{value:"Instalaci\xf3n de PhpMyAdmin",id:"instalaci\xf3n-de-phpmyadmin",level:3},{value:"Repositorio EPEL",id:"repositorio-epel",level:4},{value:"Actualizar metadatos",id:"actualizar-metadatos",level:4},{value:"Fichero de configuraci\xf3n de Apache",id:"fichero-de-configuraci\xf3n-de-apache",level:4},{value:"Fichero de configuraci\xf3n de phpMyAdmin",id:"fichero-de-configuraci\xf3n-de-phpmyadmin",level:4},{value:"Crear usuario para phpmyadmin",id:"crear-usuario-para-phpmyadmin",level:4},{value:"Configurar firewall",id:"configurar-firewall",level:4},{value:"Ajustar SELinux",id:"ajustar-selinux",level:4},{value:"Instalaci\xf3n de MariaDB",id:"instalaci\xf3n-de-mariadb",level:3},{value:"Comprobaci\xf3n de la instalaci\xf3n",id:"comprobaci\xf3n-de-la-instalaci\xf3n",level:4},{value:"Activaci\xf3n y comprobaci\xf3n del servicio",id:"activaci\xf3n-y-comprobaci\xf3n-del-servicio",level:4},{value:"Aplicaci\xf3n PHP - MariaDB",id:"aplicaci\xf3n-php---mariadb",level:2},{value:"MariaDB",id:"mariadb",level:3},{value:"Php",id:"php",level:3},{value:"Fichero index.php",id:"fichero-indexphp",level:4},{value:"Fichero dashboard.php",id:"fichero-dashboardphp",level:4},{value:"Fichero logout.php",id:"fichero-logoutphp",level:4},{value:"Inyecci\xf3n SQL cl\xe1sica",id:"inyecci\xf3n-sql-cl\xe1sica",level:2},{value:"Aplicaci\xf3n NodeJS + MongoDB",id:"aplicaci\xf3n-nodejs--mongodb",level:2},{value:"Instalaci\xf3n de MongoDB",id:"instalaci\xf3n-de-mongodb",level:3},{value:"Versi\xf3n Debian/Ubuntu",id:"versi\xf3n-debianubuntu",level:4},{value:"Versi\xf3n RHEL (incluye AlmaLinux)",id:"versi\xf3n-rhel-incluye-almalinux",level:4},{value:"Versi\xf3n Docker",id:"versi\xf3n-docker",level:4},{value:"App NodeJS",id:"app-nodejs",level:2},{value:"Instalaci\xf3n de NodeJS",id:"instalaci\xf3n-de-nodejs",level:3},{value:"Creaci\xf3n del proyecto",id:"creaci\xf3n-del-proyecto",level:3},{value:"Ejecuci\xf3n",id:"ejecuci\xf3n",level:3},{value:"MongoDB en funcionamiento",id:"mongodb-en-funcionamiento",level:4},{value:"NodeJS en funcionamiento",id:"nodejs-en-funcionamiento",level:4},{value:"Introducir datos en database",id:"introducir-datos-en-database",level:4},{value:"Inyecci\xf3n en NodeJS",id:"inyecci\xf3n-en-nodejs",level:4},{value:"Crear un servicio para NodeJS",id:"crear-un-servicio-para-nodejs",level:4},{value:"Activar Docker como servicio",id:"activar-docker-como-servicio",level:4},{value:"Crear servicio para MongoDB",id:"crear-servicio-para-mongodb",level:4},{value:"Nginx",id:"nginx",level:2},{value:"Configuraci\xf3n",id:"configuraci\xf3n",level:3},{value:"Problemas acceso en AlmaLinux",id:"problemas-acceso-en-almalinux",level:4},{value:"Problemas acceso",id:"problemas-acceso",level:2}];function t(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"hack-mv",children:"Hack MV"})}),"\n",(0,i.jsxs)(n.p,{children:["Procedo a la creaci\xf3n de una ",(0,i.jsx)(n.strong,{children:"m\xe1quina virtual"})," para ejercicios de ",(0,i.jsx)(n.strong,{children:"ciberseguridad"}),", la cual ser\xe1 un ",(0,i.jsx)(n.strong,{children:"OS GNU/Linux"})," del ecosistema ",(0,i.jsx)(n.strong,{children:"RHEL"})," para salir de mi \xe1rea de confort ",(0,i.jsx)(n.strong,{children:"Debian"}),", m\xe1s concretamente AlmaLinux 8.10."]}),"\n",(0,i.jsx)(n.h2,{id:"usuarios-del-os",children:"Usuarios del OS"}),"\n",(0,i.jsx)(n.p,{children:"Para los usuarios he usado 2 referencias de Marvel, en este caso ser\xe1n Iron Man y el Dr Doom."}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"dr-doom"})," / ",(0,i.jsx)(n.strong,{children:"Dr_????"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"iron-man"})," / ",(0,i.jsx)(n.strong,{children:"t??-?????"})]}),"\n"]})}),"\n",(0,i.jsxs)(n.p,{children:["Ambos usuarios son usuarios con privilegios reducidos, pero el acceso a la m\xe1quina por ssh se lograr\xe1 con el usuario ",(0,i.jsx)(n.strong,{children:"iron-man"}),", una vez dentro de la m\xe1quina, el ",(0,i.jsx)(n.strong,{children:"atacante"})," podr\xe1 escalar privilegios encontrando al usuario ",(0,i.jsx)(n.strong,{children:"dr-doom"}),", el cual prodr\xe1 llevar a cabo ",(0,i.jsx)(n.em,{children:"ciertas acciones"})," de ",(0,i.jsx)(n.strong,{children:"permisos elevados"})," desde una ",(0,i.jsx)(n.strong,{children:"jaula"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Para ello es necesario llevar 2 acciones clave, primero otorgar al user ",(0,i.jsx)(n.strong,{children:"dr-doom"})," un directorio donde poder ejecutar ciertos comandos, para ello es necesario modificar el fichero ",(0,i.jsx)(n.strong,{children:"/etc/sudoers"})," y luego generar en ese directorio una ",(0,i.jsx)(n.strong,{children:"jaula"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"sudoers",children:"Sudoers"}),"\n",(0,i.jsxs)(n.p,{children:["Para gestionar la escala de privilegios del usuario ",(0,i.jsx)(n.strong,{children:"dr-doom"})," se modifica el fichero ",(0,i.jsx)(n.strong,{children:"/etc/sudoers"})," ",(0,i.jsx)(n.em,{children:"(previamente se realiza un backup del mismo)"})," de la siguiente forma."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"dr-doom ALL=(ALL)  NOPASSWD: /opt/limited/*\n"})}),"\n",(0,i.jsx)(n.p,{children:"De esta forma desde ese directorio el usuario dr-doom podr\xe1 llevar a cabo las acciones permitidas por la jaula."}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"dr-doom: user"}),"\n",(0,i.jsx)(n.li,{children:"ALL [hosts] = (ALL) [users]"}),"\n",(0,i.jsx)(n.li,{children:"NOPASSWD: sin login"}),"\n",(0,i.jsx)(n.li,{children:"/opt/limited: zona de acci\xf3n donde puede operar con sudo el usuario"}),"\n"]})}),"\n",(0,i.jsx)(n.h3,{id:"jaula",children:"Jaula"}),"\n",(0,i.jsxs)(n.p,{children:["Realmente no es una jaula completa, no se usa ",(0,i.jsx)(n.strong,{children:"chroot"}),", pero si un entorno similar que permite ejecutar dentro de un directorio una consola bash a un determinado usuario."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd /opt\nmkdir limited\ncd limited\nmkdir bin\nmkdir lib\nmkdir lib64\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ahora queda copiar las librer\xedas con cp (se puede a\xf1adir -a por si hay enlaces simbolicos) del binario bash, para conseguir las librerias necesarias se usa el comando ldd."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ldd /bin/bash\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Y entonces se muestran las librer\xedas necesarias, esas ser\xe1n las que se copien a la estructura creada en el directorio ",(0,i.jsx)(n.strong,{children:"/opt/limited/"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"servidor-vsftpd",children:"Servidor vsFTPD"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo dnf install vsftpd -y\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Editar el fichero de configuraci\xf3n del servidor ",(0,i.jsx)(n.strong,{children:"FTP"})," en la ruta siguiente"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/vsftpd/vsftpd.conf\n"})}),"\n",(0,i.jsx)(n.p,{children:"Descomentar la l\xednea del fichero de configuraci\xf3n que permite habilitar al usuario anonimo"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"Anonymous_enable=YES\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Una vez descomentada la l\xednea ya se puede hacer login con el ",(0,i.jsx)(n.strong,{children:"user"})," ",(0,i.jsx)(n.em,{children:"Anonymous"})," y la ",(0,i.jsx)(n.strong,{children:"password"})," en ",(0,i.jsx)(n.em,{children:"blanco"}),", una vez permitido el acceso, se pueden subir ficheros a la siguiente ruta"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"/var/ftp/\n"})}),"\n",(0,i.jsx)(n.h2,{id:"servidor-ssh",children:"Servidor SSH"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo dnf install openshh-server\n"})}),"\n",(0,i.jsx)(n.h2,{id:"servidores-web",children:"Servidores web"}),"\n",(0,i.jsx)(n.p,{children:"Los servicios web vulnerables que ofrecen las pistas para completar el reto ser\xe1n 4: 1 nativo (80) y 3 virtuales cada uno con un dominio."}),"\n",(0,i.jsx)(n.h3,{id:"instalaci\xf3n-de-apache",children:"Instalaci\xf3n de Apache"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo dnf install -y httpd\nsudo systemctl enable --now httpd\nsudo systemctl status httpd\n"})}),"\n",(0,i.jsx)(n.h4,{id:"subdirectorios",children:"Subdirectorios"}),"\n",(0,i.jsx)(n.p,{children:"A continuaci\xf3n se crean los subdirectorios para los servidores virtuales."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo mkdir /var/www/servicio1.local/\n"})}),"\n",(0,i.jsx)(n.h4,{id:"permisos",children:"Permisos"}),"\n",(0,i.jsxs)(n.p,{children:["Si se requisiera hacer ajustes en los permisos, en este caso no es necesario porque estoy realizando todo como ",(0,i.jsx)(n.strong,{children:"root"})," y los usuarios atacantes deben de interaccionar con el navegador."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo chown -R user:grupo /var/www/servicioX.local/public_html\n"})}),"\n",(0,i.jsx)(n.h4,{id:"ficheros-index",children:"Ficheros index"}),"\n",(0,i.jsx)(n.p,{children:"Para cada dominio virtual se a\xf1ade un fichero index.html"}),"\n",(0,i.jsx)(n.h4,{id:"contenido-de-los-servicios",children:"Contenido de los servicios"}),"\n",(0,i.jsx)(n.p,{children:"Requiere la creaci\xf3n de ficheros de configuraci\xf3n, uno por servicio."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/httpd/conf.d/primero.local.conf \n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"tip",children:[(0,i.jsx)(n.p,{children:"En AlmaLinux los ficheros de configuraci\xf3n se colocan en httpd/conf.d y se les asigna la extensi\xf3n .conf y todos en el mismo directorio. No dispone del sistema de comandos a2* de Apache/Debian para habilitar y deshabilitar."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"/etc/httpd/conf/httpd.conf # Configuraci\xf3n principal\n/etc/httpd/conf.d/*.conf # Virtual hosts\n"})})]}),"\n",(0,i.jsx)(n.p,{children:"Requiere la creaci\xf3n de ficheros virtuales, aqu\xed se puede optar por usar el 80 para todos o asignar otro puerto. Esto ya ver\xe9 como lo har\xe9."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"<VirtualHost *:80>\n    ServerName servicioX.local\n    DocumentRoot /var/www/servicioX.local\n    <Directory /var/www/servicioX.local/>\n        AllowOverride All\n        Require all granted\n    </Directory>\n</VirtualHost>\n"})}),"\n",(0,i.jsx)(n.admonition,{title:"Jerarqu\xeda servidores",type:"tip",children:(0,i.jsx)(n.p,{children:"/var/www/html/            #  Server Web (nativo)\n/var/www/servicio1.local/ # virtual host 1\n/var/www/servicio2.local/ # virtual host 2\n/var/www/servicio3.local/ # virtual host 3"})}),"\n",(0,i.jsx)(n.h4,{id:"modificar-fichero-etchosts",children:"Modificar fichero /etc/hosts"}),"\n",(0,i.jsx)(n.p,{children:"A\xf1adir al fichero de configuraci\xf3n de los hosts los nombres de dominio de los servidores virtuales asociados a la m\xe1quina virtual."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"127.0.0.1   servicioX.local\n"})}),"\n",(0,i.jsx)(n.h2,{id:"php-y-mariadb",children:"PHP y MariaDB"}),"\n",(0,i.jsx)(n.h3,{id:"instalaci\xf3n-de-php",children:"Instalaci\xf3n de PHP"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo dnf install php php-mysqlnd php-json php-mbstring php-common php-xml php-cli php-gd php-opcache php-pdo -y\n"})}),"\n",(0,i.jsx)(n.h4,{id:"verificaci\xf3n-de-la-instalaci\xf3n",children:"Verificaci\xf3n de la instalaci\xf3n"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"php --version\n"})}),"\n",(0,i.jsx)(n.h3,{id:"instalaci\xf3n-de-phpmyadmin",children:"Instalaci\xf3n de PhpMyAdmin"}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"Esto se puede convertir en una odisea en sistemas operativos RHEL por SElinux y la gesti\xf3n que\nusan estas distros de dependencias comparado a distros Debian."})}),"\n",(0,i.jsx)(n.h4,{id:"repositorio-epel",children:"Repositorio EPEL"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo dnf install epel-release -y\n"})}),"\n",(0,i.jsx)(n.h4,{id:"actualizar-metadatos",children:"Actualizar metadatos"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo dnf clean all && sudo dnf makecache\n"})}),"\n",(0,i.jsx)(n.p,{children:"Sigue sin encontrar phpmyadmin entonces se va a descargar directamente"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -L -o phpMyAdmin.tar.gz https://www.phpmyadmin.net/downloads/phpMyAdmin-latest-all-languages.tar.gz\nsudo mkdir /usr/share/phpMyAdmin\nsudo tar xzf phpMyAdmin.tar.gz -C /usr/share/phpMyAdmin --strip-components=1\nls /usr/share/phpMyAdmin # Comprobar que est\xe1n todos los ficheros\n"})}),"\n",(0,i.jsx)(n.h4,{id:"fichero-de-configuraci\xf3n-de-apache",children:"Fichero de configuraci\xf3n de Apache"}),"\n",(0,i.jsxs)(n.p,{children:["Crear un fichero en ",(0,i.jsx)(n.strong,{children:"/etc/httpd/conf.d/phpMyAdmin"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"Alias /phpmyadmin /usr/share/phpMyAdmin\n\n<Directory /usr/share/phpMyAdmin/>\n    Require all granted\n</Directory>\n"})}),"\n",(0,i.jsx)(n.h4,{id:"fichero-de-configuraci\xf3n-de-phpmyadmin",children:"Fichero de configuraci\xf3n de phpMyAdmin"}),"\n",(0,i.jsx)(n.p,{children:"Requiere generar uno propio usando de referencia el proporcionado como ejemplo"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cp /usr/share/phpMyAdmin/config.sample.inc.php /usr/share/phpMyAdmin/config.inc.php\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ajustar estas lineas"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$cfg['blowfish_secret'] = ''; // Contrase\xf1a para encriptar cookies y dem\xe1s\n$cfg['Servers'][1]['host'] = '10.255.255.77';  // IP del servidor MariaDB\n$cfg['Servers'][1]['auth_type'] = 'cookie';    // Para pedir usuario y contrase\xf1a\n$cfg['Servers'][1]['AllowNoPassword'] = false; // No permitir conexi\xf3n sin contrase\xf1a\n\n"})}),"\n",(0,i.jsx)(n.h4,{id:"crear-usuario-para-phpmyadmin",children:"Crear usuario para phpmyadmin"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE USER IF NOT EXISTS 'phpmyadmin'@'%' IDENTIFIED BY ''; -- Creaci\xf3n user\nGRANT ALL PRIVILEGES ON *.* TO 'phpmyadmin'@'%' WITH GRANT OPTION; -- Permisos *.* (db.table)\nFLUSH PRIVILEGES; -- Recarga permisos\n"})}),"\n",(0,i.jsx)(n.p,{children:"Comprobar que funciona correctamente"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mysql -u phpmyadmin -h <IP> -p\n"})}),"\n",(0,i.jsx)(n.h4,{id:"configurar-firewall",children:"Configurar firewall"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo firewall-cmd --permanent --add-port=3306/tcp\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --reload\n"})}),"\n",(0,i.jsx)(n.h4,{id:"ajustar-selinux",children:"Ajustar SELinux"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo sestatus\nsudo setsebool -P httpd_can_network_connect_db 1 # Permanente\nsudo setenforce 0 # Temporal\n"})}),"\n",(0,i.jsx)(n.h3,{id:"instalaci\xf3n-de-mariadb",children:"Instalaci\xf3n de MariaDB"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo dnf install mariadb-server\n"})}),"\n",(0,i.jsx)(n.h4,{id:"comprobaci\xf3n-de-la-instalaci\xf3n",children:"Comprobaci\xf3n de la instalaci\xf3n"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mysql --version\n"})}),"\n",(0,i.jsx)(n.h4,{id:"activaci\xf3n-y-comprobaci\xf3n-del-servicio",children:"Activaci\xf3n y comprobaci\xf3n del servicio"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"systemctl enable mariadb\nsystemctl start mariadb\nsystemctl status mariadb\n"})}),"\n",(0,i.jsx)(n.h2,{id:"aplicaci\xf3n-php---mariadb",children:"Aplicaci\xf3n PHP - MariaDB"}),"\n",(0,i.jsx)(n.h3,{id:"mariadb",children:"MariaDB"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE DATABASE hack;\nUSE hack;\n\ncreate table users( id INT ZEROFILL AUTO_INCREMENT PRIMARY KEY, user varchar (64), password varchar (64) ) ENGINE = INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish2_ci; \n\nINSERT INTO users (user, password) VALUES\n('admin', '<password>')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"php",children:"Php"}),"\n",(0,i.jsx)(n.h4,{id:"fichero-indexphp",children:"Fichero index.php"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:'<?php\n// Creaci\xf3n de la sesi\xf3n\nsession_start();\n\n// Se comprueba si existe el usuario\nif (isset($_SESSION["user"])) {\n    // Si se est\xe1 logueado se va al dashboard.php\t\n    header("Location: dashboard.php");\n    exit();\n}\n\n// Si no se est\xe1 logueado \nif ($_SERVER["REQUEST_METHOD"] == "POST" && isset($_POST["user"])) {\n    $con = new mysqli(\'localhost\', \'root\', \'\', \'hack\');\n    if ($con->connect_error) {\n        die("Error en la conexi\xf3n a base de datos");\n    }\n\n    // Guardar los datos del user \t\n    $user = $_POST["user"];     \n    $pass = $_POST["password"]; \n\n    // Consulta SQL muy Vulnerable\n    $query = "SELECT * FROM users WHERE user = \'$user\' AND password = \'$pass\'";\n    $result = $con->query($query);\n\n    if ($result->num_rows > 0) {\n        $_SESSION["user"] = $user; \n        header("Location: dashboard.php");\n        exit();\n    } else {\n        echo "Datos de acceso incorrectos";\n    }\n}\n?>\n<!DOCTYPE html>\n<html lang="es">\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n  <title>Hack me: Index </title>\n  <style>\n    * {\n      box-sizing: border-box;\n      margin: 0;\n      padding: 0;\n    }\n\n    html, body {\n      height: 100%;\n      font-family: sans-serif;\n      background: #f5f5f5;\n    }\n\n    body {\n      display: grid;\n      grid-template-rows: auto 1fr;\n      grid-template-columns: 1fr;\n      grid-template-areas: \n        "header"\n        "content";\n    }\n\n    header {\n      grid-area: header;\n      background-color: #333;\n      color: #fff;\n      padding: 1rem;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      z-index: 10;\n    }\n    \n    /* Icono men\xfa hamburguesa */\n    .hamburger {\n      font-size: 1.8rem;\n      cursor: pointer;\n      user-select: none;\n    }\n\n    /* Modal - PopUp */\n    .content {\n      grid-area: content;\n      display: flex;\n      justify-content: center;\n      align-items: start;\n      padding: 6rem 2rem 2rem; \n    }\n\n    .content-inner {\n      background: #fff;\n      width: 68rem;\n      max-width: 100%;\n      min-height: 14rem;\n      box-shadow: 0 0 10px rgba(0,0,0,0.1);\n      padding: 2rem;\n      border-radius: 8px;\n      margin-top:10rem;\n    }\n\n    .content-inner a {\n      color: #007BFF;\n      text-decoration: underline;\n      cursor: pointer;\n    }\n\n    /* Men\xfa oculto debajo del header */\n    .menu {\n      position: fixed;\n      top: 4rem; \n      left: 0;\n      width: 100%;\n      height: calc(100% - 4rem); \n      background: #444;\n      color: #fff;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      gap: 2rem;\n      transform: translateX(-100%); /* Se oculta el men\xfa de LTR */\n      transition: transform 0.4s ease;\n      z-index: 9;\n    }\n\n    .menu.active { \n      transform: translateX(0); /* Se muestra el men\xfa de LTR */\n    }\n\n    .menu a {\n      color: #fff;\n      text-decoration: none;\n      font-size: 1.5rem;\n      transition: color 0.2s;\n    }\n\n    .menu a:hover {\n      color: #ddd;\n    }\n\n  </style>\n</head>\n<body>\n\x3c!-- Barra Superior --\x3e\n  <header>\n    \x3c!-- div class="hamburger" onclick="toggleMenu()">\u2630</div--\x3e\n    <h1>Hack me!</h1>\n  </header>\n\n\x3c!-- Men\xfa Lateral, oculto/visible con toggle --\x3e\n  <nav class="menu" id="menu">\n    <a href="#">Log In</a>\n    <a href="#">Log Out</a>\n  </nav>\n\n\x3c!-- Contenido centrado --\x3e\n  <div class="content">\n<div class="content-inner" style="width: 320px; padding: 1rem;">\n  <h2 style="text-align: center;padding:.5rem 0 1.5rem 0;">Hack Me App</h2>\n  <form method="POST" action="<?php echo htmlspecialchars($_SERVER[\'PHP_SELF\']); ?>" style="display: flex; flex-direction: column; gap: 0.8rem;">\n      <input type="text" name="user" required style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">\n      <input type="password" name="password" required style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">\n      <input type="submit" value="Acceder" style="width: 100%; padding: 0.5rem; background: #333; color: #fff; border: none; border-radius: 4px; cursor: pointer;margin-bottom:1rem;">\n  </form>\n</div>\n  </div>\n  <script>\n    function toggleMenu() {\n       /* Capturar elemento men\xfa y jugar con su visibilidad */\n      document.getElementById(\'menu\').classList.toggle(\'active\');\n    }\n  <\/script>\n</body>\n</html>\n'})}),"\n",(0,i.jsx)(n.h4,{id:"fichero-dashboardphp",children:"Fichero dashboard.php"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'<?php\nsession_start();\nif(!isset($_SESSION["user"])){\n\theader("Location: index.php");\n\texit();\n}\n?>\n<!DOCTYPE html>\n<html lang="es">\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n  <title>Hack me: Dashboard </title>\n  <style>\n    * {\n      box-sizing: border-box;\n      margin: 0;\n      padding: 0;\n    }\n\n    html, body {\n      height: 100%;\n      font-family: sans-serif;\n      background: #f5f5f5;\n    }\n\n    body {\n      display: grid;\n      grid-template-rows: auto 1fr;\n      grid-template-columns: 1fr;\n      grid-template-areas: \n        "header"\n        "content";\n    }\n\n    header {\n      grid-area: header;\n      background-color: #333;\n      color: #fff;\n      padding: 1rem;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      z-index: 10;\n    }\n    \n    /* Icono men\xfa hamburguesa */\n    .hamburger {\n      font-size: 1.8rem;\n      cursor: pointer;\n      user-select: none;\n    }\n\n    /* Modal - PopUp */\n    .content {\n      grid-area: content;\n      display: flex;\n      justify-content: center;\n      align-items: start;\n      padding: 6rem 2rem 2rem; \n    }\n\n    .content-inner {\n      background: #fff;\n      width: 68rem;\n      max-width: 100%;\n      min-height: 40rem;\n      box-shadow: 0 0 10px rgba(0,0,0,0.1);\n      padding: 2rem;\n      border-radius: 8px;\n    }\n\n    .content-inner a {\n      color: #007BFF;\n      text-decoration: underline;\n      cursor: pointer;\n    }\n\n    /* Men\xfa oculto debajo del header */\n    .menu {\n      position: fixed;\n      top: 4rem; \n      left: 0;\n      width: 100%;\n      height: calc(100% - 4rem); \n      background: #444;\n      color: #fff;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      gap: 2rem;\n      transform: translateX(-100%); /* Se oculta el men\xfa de LTR */\n      transition: transform 0.4s ease;\n      z-index: 9;\n    }\n\n    .menu.active { \n      transform: translateX(0); /* Se muestra el men\xfa de LTR */\n    }\n\n    .menu a {\n      color: #fff;\n      text-decoration: none;\n      font-size: 1.5rem;\n      transition: color 0.2s;\n    }\n\n    .menu a:hover {\n      color: #ddd;\n    }\n\n  </style>\n</head>\n<body>\n\x3c!-- Barra Superior --\x3e\n  <header>\n    <div class="hamburger" onclick="toggleMenu()">\u2630</div>\n    <h1>Hack me!</h1>\n  </header>\n\n\x3c!-- Men\xfa Lateral, oculto/visible con toggle --\x3e\n  <nav class="menu" id="menu">\n    <a href="index.php">Log In</a>\n    <a href="logout.php">Log Out</a>\n  </nav>\n\n\x3c!-- Contenido centrado --\x3e\n  <div class="content">\n    <div class="content-inner">\n      <h2>Hack Me: Dashboard</h2>\n      <p style="padding:1rem 0 1.5rem 0;"><?php echo "Bienvenido Sr./Sra. ".$_SESSION["user"]; ?></p>\n      <p></p>\n      <table style="border-collapse: collapse; width: 100%; text-align: center;">\n  <tr style="background-color: #555;color:white;">\n    <td style="padding: 8px; border: 1px solid #222;">User</td>\n    <td style="padding: 8px; border: 1px solid #222;">Password</td>\n    <td style="padding: 8px; border: 1px solid #222;">Description</td>\n\n  </tr>\n  <tr style="background-color: #f3f3f3;">\n    <td style="padding: 8px; border: 1px solid #222;">Spiderman</td>\n    <td style="padding: 8px; border: 1px solid #222;">********</td>\n    <td style="padding: 8px; border: 1px solid #222">The Amazing Spiderman</td>\n  </tr>\n  </tr>\n    <tr style="background-color: #c3c3c3;">\n    <td style="padding: 8px; border: 1px solid #222;">Gata Negra</td>\n    <td style="padding: 8px; border: 1px solid #222;">********</td>\n    <td style="padding: 8px; border: 1px solid #222;">Felicia Hardy</td>\n  </tr>\n  <tr style="background-color: #f3f3f3;">\n    <td style="padding: 8px; border: 1px solid #222;">Dr Doom</td>\n    <td style="padding: 8px; border: 1px solid #222;">********</td>\n    <td style="padding: 8px; border: 1px solid #222;">Victor Von Doom</td>\n  </tr>\n    <tr style="background-color: #c3c3c3;">\n    <td style="padding: 8px; border: 1px solid #222;">Jean Grey</td>\n    <td style="padding: 8px; border: 1px solid #222;">********</td>\n    <td style="padding: 8px; border: 1px solid #222;">Jean Elaine Grey Summers</td>\n  </tr>\n  </tr>\n    <tr style="background-color: #f3f3f3;">\n    <td style="padding: 8px; border: 1px solid #222;">Lobezno</td>\n    <td style="padding: 8px; border: 1px solid #222;">********</td>\n    <td style="padding: 8px; border: 1px solid #222;">James Howlet</td>\n  </tr>\n  </tr>\n    <tr style="background-color: #c3c3c3;">\n    <td style="padding: 8px; border: 1px solid #222;">Viuda Negra</td>\n    <td style="padding: 8px; border: 1px solid #222;">********</td>\n    <td style="padding: 8px; border: 1px solid #222;">Natasha Romanova</td>\n  </tr>\n</table>\n    </div>\n  </div>\n\n\n  <script>\n    function toggleMenu() {\n       /* Capturar elemento men\xfa y jugar con su visibilidad */\n      document.getElementById(\'menu\').classList.toggle(\'active\');\n    }\n  <\/script>\n</body>\n</html>\n\n\n'})}),"\n",(0,i.jsx)(n.h4,{id:"fichero-logoutphp",children:"Fichero logout.php"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'<?php\nsession_start();\nsession_unset();\nsession_destroy();\nheader("Location: index.php");\n?>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"inyecci\xf3n-sql-cl\xe1sica",children:"Inyecci\xf3n SQL cl\xe1sica"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"' OR '1'='1' -- # Importante, dejar un espacio despu\xe9s del comentario\nSELECT * FROM users WHERE user = '' OR '1'='1' -- ' AND password = 'abc'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"aplicaci\xf3n-nodejs--mongodb",children:"Aplicaci\xf3n NodeJS + MongoDB"}),"\n",(0,i.jsx)(n.h3,{id:"instalaci\xf3n-de-mongodb",children:"Instalaci\xf3n de MongoDB"}),"\n",(0,i.jsx)(n.h4,{id:"versi\xf3n-debianubuntu",children:"Versi\xf3n Debian/Ubuntu"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'wget -qO - https://pgp.mongodb.com/server-7.0.asc | sudo tee /etc/apt/trusted.gpg.d/mongodb-server-7.0.gpg > /dev/null && echo "deb [ arch=amd64 ] https://repo.mongodb.org/apt/debian bookworm/mongodb-org/7.0 main" | sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list\n\nsudo apt update\nsudo apt install -y mongodb-org && sudo systemctl enable --now mongod\n\nmongosh\n'})}),"\n",(0,i.jsx)(n.h4,{id:"versi\xf3n-rhel-incluye-almalinux",children:"Versi\xf3n RHEL (incluye AlmaLinux)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/yum.repos.d/mongodb.repo\n\n[mongodb-org-6.0]\nname=MongoDB Repository\nbaseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/6.0/x86_64/\ngpgcheck=1\nenabled=1\ngpgkey=https://www.mongodb.org/static/pgp/server-6.0.asc\n\nsudo dnf install -y mongodb-org\nsudo systemctl enable --now mongod\n\nsudo ufw allow 27017/tcp    # Debian (ufw)\nsudo firewall-cmd --permanent --add-port=27017/tcp\nsudo firewall-cmd --reload  # AlmaLinux (firewalld)\n"})}),"\n",(0,i.jsxs)(n.admonition,{title:"Conexiones externas",type:"warning",children:[(0,i.jsxs)(n.p,{children:["Editar el fichero ",(0,i.jsx)(n.strong,{children:"/etc/mongod.conf"})]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"/etc/mongod.conf\n"})}),(0,i.jsxs)(n.p,{children:["Y usar la ",(0,i.jsx)(n.strong,{children:"wildcard"})," ",(0,i.jsx)(n.strong,{children:"0.0.0.0"})," en ",(0,i.jsx)(n.strong,{children:"bindIp"}),"."]})]}),"\n",(0,i.jsx)(n.h4,{id:"versi\xf3n-docker",children:"Versi\xf3n Docker"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo dnf update -y # actualizar dnf\nsudo dnf install -y yum-utils # herramientas necesarias\nsudo dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo # a\xf1adir repo\nsudo dnf install -y docker-ce docker-ce-cli containerd.io # instalar docker\nsudo systemctl enable --now docker # activar el servicio\nsudo usermod -aG docker $USER # a\xf1adir user al grupo\nnewgrp docker # recargar permisos del grupo\n"})}),"\n",(0,i.jsx)(n.h2,{id:"app-nodejs",children:"App NodeJS"}),"\n",(0,i.jsx)(n.p,{children:"La aplicaci\xf3n desarrollada en NodeJS, es una aplicaci\xf3n sencilla que permite inyecci\xf3n No-SQL, para ello se ha usado MongoDB y dado que da problemas las ultimas versiones por instrucciones ilegales en lo sistemas de virtualizaci\xf3n de virtual box y las versiones m\xe1s viejas por determinadas librer\xedas, tomo la decici\xf3n de usar docker y crear un contenedor para el servicio docker."}),"\n",(0,i.jsx)(n.p,{children:"El contenedor requer\xeda de un volumen para la persistencia de datos, por ello se generar\xe1 un directorio para ello."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mkdir /opt/mongodb/\n"})}),"\n",(0,i.jsx)(n.p,{children:"Una vez creado el volumen se crea el contendor con la imagen de mongodb, mapeando el puerto del host 27017 al 27017 del contenedor, de esta forma no habr\xe1 problemas para poder usar el servidor de nodejs del host con MongoDB, eso s\xed, tambi\xe9n hay que usar una imagen vieja. Anterior a la 5.0 que usa instrucciones AVX."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run -d \\\n  --name mongodb \\\n  -p 27017:27017 \\\n  -v /opt/mongodb:/data/db \\\n  mongo:4.4\n"})}),"\n",(0,i.jsxs)(n.admonition,{title:"Repaso comandos docker",type:"tip",children:[(0,i.jsxs)(n.p,{children:["Los comandos ",(0,i.jsx)(n.strong,{children:"docker"})," pueden liar porque ha evolcionado la sintaxis y a veces se pueden mezclar sintaxis antigua y moderna."]}),(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Comando antiguo"}),(0,i.jsx)(n.th,{children:"Comando actual"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"docker rm"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"docker container rm"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"docker rmi"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"docker image rm"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"No exist\xeda"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"docker volume rm"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"No exist\xeda"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"docker network rm"})})]})]})]}),(0,i.jsxs)(n.p,{children:["Adem\xe1s es importante asegurarse de que mongodb sea propietarios del directorio, tanto el user como el group, por ello en vez de usar ",(0,i.jsx)(n.strong,{children:"mongodb"})," se usara el ",(0,i.jsx)(n.strong,{children:"id"})," de user y group."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"chown 999:999 /opt/mongodb/\n"})})]}),"\n",(0,i.jsx)(n.h3,{id:"instalaci\xf3n-de-nodejs",children:"Instalaci\xf3n de NodeJS"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -fsSL https://rpm.nodesource.com/setup_20.x | sudo bash -\ndnf install -y nodejs\n"})}),"\n",(0,i.jsx)(n.h3,{id:"creaci\xf3n-del-proyecto",children:"Creaci\xf3n del proyecto"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mkdir /opt/app-node/\nnpm init -y\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'const express = require(\'express\');\nconst { MongoClient } = require(\'mongodb\');\n\nconst app = express();\nconst port = 3000;\n\napp.use(express.urlencoded({ extended: false }));\napp.use(express.json());\n\nconst uri = \'mongodb://localhost:27017\';\nconst dbName = \'testdb\';\nlet db;\n\nMongoClient.connect(uri, { useUnifiedTopology: true })\n  .then(client => {\n    db = client.db(dbName);\n    console.log(\'\u2705 Conectado a MongoDB\');\n\n    app.listen(port, \'0.0.0.0\', () => {\n      console.log(`\ud83d\ude80 Servidor en http://localhost:${port}`);\n    });\n  })\n  .catch(err => console.error(\'\u274c Error al conectar con MongoDB\', err));\n\napp.get(\'/login\', (req, res) => {\n  res.send(`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>Login</title>\n  <style>\n    body {\n      margin: 0;\n      font-family: sans-serif;\n      display: grid;\n      grid-template-rows: 4rem auto;\n      height: 100vh;\n    }\n    header {\n      background-color: #333;\n      color: white;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 1.5rem;\n    }\n    main {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    .login-box {\n      padding: 2rem;\n      border-radius: 8px;\n      box-shadow: 0 0 10px rgba(0,0,0,0.2);\n      background: #f9f9f9;\n      min-width: 250px;\n      width: fit-content;\n      display: grid;\n      gap: 1rem;\n    }\n    input {\n      padding: 0.5rem;\n      font-size: 1rem;\n      width: 100%;\n    }\n    button {\n      padding: 0.5rem;\n      font-size: 1rem;\n      cursor: pointer;\n      background-color: #333;\n      color: white;\n      border: none;\n    }\n    @media (max-width: 600px) {\n      .login-box {\n        width: 100%;\n        max-width: 90vw;\n        padding: 1rem;\n      }\n    }\n  </style>\n</head>\n<body>\n  <header>Login App</header>\n  <main>\n    <form method="POST" action="/login" class="login-box">\n      <input name="email" placeholder="email" required />\n      <input name="password" placeholder="password" required />\n      <button type="submit">Login</button>\n    </form>\n  </main>\n</body>\n</html>`);\n});\n\napp.post(\'/login\', async (req, res) => {\n  let { email, password } = req.body;\n\n  try {\n    password = JSON.parse(password);\n  } catch (e) {\n    // si no es JSON v\xe1lido, se queda como string\n  }\n\n  try {\n    const user = await db.collection(\'users\').findOne({ email, password });\n\n    if (user) {\n      res.send(`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>Login exitoso</title>\n  <style>\n    body {\n      margin: 0;\n      font-family: sans-serif;\n      display: grid;\n      grid-template-rows: 4rem auto;\n      height: 100vh;\n    }\n    header {\n      background-color: #333;\n      color: white;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 1.5rem;\n    }\n    main {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    .result-box {\n      padding: 2rem;\n      border-radius: 8px;\n      box-shadow: 0 0 10px rgba(0,0,0,0.2);\n      background: #e7ffe7;\n      min-width: 250px;\n      width: fit-content;\n      display: grid;\n      gap: 1rem;\n    }\n    pre {\n      margin: 0;\n      font-size: 1rem;\n      background: #fff;\n      padding: 1rem;\n      border: 1px solid #ccc;\n    }\n    @media (max-width: 600px) {\n      .result-box {\n        width: 100%;\n        max-width: 90vw;\n        padding: 1rem;\n      }\n    }\n  </style>\n</head>\n<body>\n  <header>Login App</header>\n  <main>\n    <div class="result-box">\n      <pre>\u2705 Usuario encontrado:\\n${JSON.stringify(user, null, 2)}</pre>\n    </div>\n  </main>\n</body>\n</html>`);\n    } else {\n      res.send(`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>Login fallido</title>\n  <style>\n    body {\n      margin: 0;\n      font-family: sans-serif;\n      display: grid;\n      grid-template-rows: 4rem auto;\n      height: 100vh;\n    }\n    header {\n      background-color: #333;\n      color: white;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 1.5rem;\n    }\n    main {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    .result-box {\n      padding: 2rem;\n      border-radius: 8px;\n      box-shadow: 0 0 10px rgba(0,0,0,0.2);\n      background: #ffecec;\n      min-width: 250px;\n      width: fit-content;\n      display: grid;\n      gap: 1rem;\n    }\n    p {\n      margin: 0;\n      font-size: 1.1rem;\n      color: #b00;\n      font-weight: bold;\n      text-align: center;\n    }\n    @media (max-width: 600px) {\n      .result-box {\n        width: 100%;\n        max-width: 90vw;\n        padding: 1rem;\n      }\n    }\n  </style>\n</head>\n<body>\n  <header>Login App</header>\n  <main>\n    <div class="result-box">\n      <p>\u274c Usuario no encontrado.</p>\n    </div>\n  </main>\n</body>\n</html>`);\n    }\n  } catch (err) {\n   res.status(500).send(`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>Error en la consulta</title>\n  <style>\n    body {\n      margin: 0;\n      font-family: sans-serif;\n      display: grid;\n      grid-template-rows: 4rem auto;\n      height: 100vh;\n    }\n    header {\n      background-color: #333;\n      color: white;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 1.5rem;\n    }\n    main {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    .result-box {\n      padding: 2rem;\n      border-radius: 8px;\n      box-shadow: 0 0 10px rgba(0,0,0,0.2);\n      background: #fff4e5;\n      min-width: 250px;\n      width: fit-content;\n      display: grid;\n      gap: 1rem;\n    }\n    p {\n      margin: 0;\n      font-size: 1.1rem;\n      color: #a60;\n      font-weight: bold;\n      text-align: center;\n    }\n    @media (max-width: 600px) {\n      .result-box {\n        width: 100%;\n        max-width: 90vw;\n        padding: 1rem;\n      }\n    }\n  </style>\n</head>\n<body>\n  <header>Login App</header>\n  <main>\n    <div class="result-box">\n      <p>\ud83d\udca5 Error interno en la consulta. Intenta m\xe1s tarde.</p>\n    </div>\n  </main>\n</body>\n</html>`);\n\n  }\n});\n\n'})}),"\n",(0,i.jsx)(n.h3,{id:"ejecuci\xf3n",children:"Ejecuci\xf3n"}),"\n",(0,i.jsx)(n.h4,{id:"mongodb-en-funcionamiento",children:"MongoDB en funcionamiento"}),"\n",(0,i.jsx)(n.p,{children:"Lanzar el contenedor de mongodb"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run -d \\\n  --name mongodb \\\n  -p 27017:27017 \\\n  -v /opt/mongodb:/data/db \\\n  mongo:4.4.18\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Se puede configurar para que siempre se reinicie el contenedor autom\xe1ticamente con el proceso de ",(0,i.jsx)(n.strong,{children:"docker"}),", deber\xeda de funcionar siempre, pero me gusta m\xe1s tener un script incorporado en el  ",(0,i.jsx)(n.strong,{children:"systemd"})," y activarlo como servicio, de todas formas la opci\xf3n del comando es la siguiente."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker update --restart=always mongodb\n"})}),"\n",(0,i.jsx)(n.h4,{id:"nodejs-en-funcionamiento",children:"NodeJS en funcionamiento"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"node server.js #/opt/app-node\n"})}),"\n",(0,i.jsx)(n.h4,{id:"introducir-datos-en-database",children:"Introducir datos en database"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'use testdb\n\ndb.users.insertOne({\n  email: "victima@example.com",\n  password: "123456"\n})\n'})}),"\n",(0,i.jsx)(n.h4,{id:"inyecci\xf3n-en-nodejs",children:"Inyecci\xf3n en NodeJS"}),"\n",(0,i.jsx)(n.p,{children:"Inyecci\xf3n para acceder al servidor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'{"$ne": null }\n'})}),"\n",(0,i.jsx)(n.h4,{id:"crear-un-servicio-para-nodejs",children:"Crear un servicio para NodeJS"}),"\n",(0,i.jsx)(n.p,{children:"Creo un servicio para el inicio a systemd del servidor de NodeJS.\nsudo nano /etc/systemd/system/nodeapp.service"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"[Unit] # Unidad, descripci\xf3n y relaci\xf3n con otras\nDescription=Servidor web App con NodeJS\nAfter=network.target docker.service\nRequires=docker.service\n\n[Service] # Configuraci\xf3n del servicio\nExecStart=/usr/bin/node /opt/app-node/server.js\nWorkingDirectory=/opt/app-node\nRestart=always\nUser=nobody\nEnvironment=NODE_ENV=production\n\n[Install] # Conexi\xf3n con el sistema de arranque, nivel de target\nWantedBy=multi-user.target\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Reiniciar systemd, activar servicio y lanzar"}),"\n",(0,i.jsx)(n.h4,{id:"activar-docker-como-servicio",children:"Activar Docker como servicio"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable --now docker\n"})}),"\n",(0,i.jsx)(n.h4,{id:"crear-servicio-para-mongodb",children:"Crear servicio para MongoDB"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"/etc/systemd/system/mongodb-container.service\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"[Unit]\nDescription=Contenedor MongoDB\nRequires=docker.service\nAfter=docker.service\n\n[Service]\nRestart=always\nExecStart=/usr/bin/docker start -a mongodb\nExecStop=/usr/bin/docker stop mongodb\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl d-reexec\nsudo systemctl enable mongodb-container\nsudo systemctl start mongodb-container\n\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"warning",children:[(0,i.jsxs)(n.p,{children:["Comando ",(0,i.jsx)(n.strong,{children:"systemd-analyze"})," para verificar el servicio"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"systemd-analyze verify file.service\n"})})]}),"\n",(0,i.jsx)(n.h2,{id:"nginx",children:"Nginx"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo dnf install nginx -y\nsudo systemctl start nginx\nsudo systemctl enable nginx\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo firewall-cmd --reload\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configuraci\xf3n",children:"Configuraci\xf3n"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"/etc/nginx/nginx.conf\n/etc/nginx/conf.d/\nnginx -t # validar la configuraci\xf3n\n"})}),"\n",(0,i.jsx)(n.h4,{id:"problemas-acceso-en-almalinux",children:"Problemas acceso en AlmaLinux"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo dnf install policycoreutils-python-utils -y\nsudo semanage port -a -t http_port_t -p tcp 8080\nsudo semanage port -a -t http_port_t -p tcp 6969\nsudo cat /var/log/nginx/error.log\n"})}),"\n",(0,i.jsx)(n.h2,{id:"problemas-acceso",children:"Problemas acceso"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo firewall-cmd --list-all\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --reload\nsudo ss -tlnp | grep httpd\nsudo sestatus # Estado de SElinux\ngetenforce # Modo de ejecuci\xf3n de SElinux\nsudo setenforce 0 #Disable\n```\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>d});var a=r(6540);const i={},s=a.createContext(i);function o(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);
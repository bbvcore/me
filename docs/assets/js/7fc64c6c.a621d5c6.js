"use strict";(self.webpackChunkmydocs=self.webpackChunkmydocs||[]).push([[2353],{363:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"OT/IIOT/telegraf","title":"Telegraf","description":"Despliegue modular","source":"@site/docs/OT/IIOT/telegraf.md","sourceDirName":"OT/IIOT","slug":"/OT/IIOT/telegraf","permalink":"/me/docs/docs/OT/IIOT/telegraf","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/OT/IIOT/telegraf.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Telegraf"},"sidebar":"tutorialSidebar","previous":{"title":"InfluxDB","permalink":"/me/docs/docs/OT/IIOT/influxDB"},"next":{"title":"Node-red","permalink":"/me/docs/docs/OT/IIOT/node-red"}}');var a=r(4848),t=r(8453);const o={sidebar_position:1,title:"Telegraf"},i="Telegraf",c={},l=[{value:"Despliegue modular",id:"despliegue-modular",level:2},{value:"Fichero telegraf.d",id:"fichero-telegrafd",level:3},{value:"Fichero mqtt.confls",id:"fichero-mqttconfls",level:3},{value:"Fichero influxdb.conf",id:"fichero-influxdbconf",level:3},{value:"Fichero system.conf",id:"fichero-systemconf",level:3},{value:"Chuleta de comandos para Telegraf",id:"chuleta-de-comandos-para-telegraf",level:2},{value:"Opci\xf3n compatible con telegraf.conf",id:"opci\xf3n-compatible-con-telegrafconf",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components},{Details:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"telegraf",children:"Telegraf"})}),"\n",(0,a.jsx)(n.h2,{id:"despliegue-modular",children:"Despliegue modular"}),"\n",(0,a.jsxs)(n.p,{children:["Para el despliegue modular se aplica una configuraci\xf3n minimalista en el fichero ",(0,a.jsx)(n.strong,{children:"telegraf.conf"})," y dentro del directorio ",(0,a.jsx)(n.strong,{children:"conf.d"})," se alojar\xe1n ficheros de configurac\xf3n para la recepci\xf3n de los datos de los sistemas mediante el uso de ",(0,a.jsx)(n.strong,{children:"agentes"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"fichero-telegrafd",children:"Fichero telegraf.d"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:(0,a.jsx)(n.p,{children:"Fichero del agente"})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'[agent]\n  interval = "10s"\n  round_interval = true\n  metric_batch_size = 1000\n  metric_buffer_limit = 10000\n  collection_jitter = "0s"\n  flush_interval = "10s"\n  flush_jitter = "0s"\n  precision = ""\n  hostname = "hist-db"\n  omit_hostname = false\n  debug = true\n  logfile = ""\n\n# Directorio que contiene las configuraciones modulares\n# Se encarga de habilitar la carga de los ficheros alojados en `telegraf.d/*.conf`\n[global_tags]\n\n# Salidas (si quieres, puedes ponerlas aqu\xed tambi\xe9n o en .d/)\n# [[outputs.influxdb_v2]]\n#    urls = ["http://localhost:8086"]\n#    token = "tu-token"\n#    organization = "tu-org"\n#    bucket = "mi-bucket"\n'})})]}),"\n",(0,a.jsx)(n.h3,{id:"fichero-mqttconfls",children:"Fichero mqtt.confls"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:(0,a.jsx)(n.p,{children:"Fichero de configuraci\xf3n para el protocolo MQTT"})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'[[inputs.mqtt_consumer]]\n  servers = ["tcp://192.168.56.106:1883"]\n  topics = ["/sensores/#"]\n  qos = 0\n  data_format = "json"\n'})})]}),"\n",(0,a.jsx)(n.h3,{id:"fichero-influxdbconf",children:"Fichero influxdb.conf"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:(0,a.jsx)(n.p,{children:"Fichero de configuraci\xf3n para la salida de los datos hac\xeda InfluxDB"})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'[[outputs.influxdb_v2]]\n  urls = ["http://localhost:8086"]\n  token = "A\xf1adir el Token de InfluxDB"\n  organization = "A\xf1adir la organizaci\xf3n"\n  bucket = "A\xf1adir el bucket"\n'})})]}),"\n",(0,a.jsx)(n.h3,{id:"fichero-systemconf",children:"Fichero system.conf"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:(0,a.jsx)(n.p,{children:"Fichero de configuraci\xf3n de los datos del sistema."})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"[[inputs.cpu]]\n  percpu = true\n  totalcpu = true\n  collect_cpu_time = false\n  report_active = false\n\n[[inputs.mem]]\n[[inputs.disk]]\n[[inputs.diskio]]\n[[inputs.processes]]\n[[inputs.system]]\n"})}),(0,a.jsx)(n.admonition,{title:"Revisar permisos de Usuario",type:"warning",children:(0,a.jsx)(n.p,{children:"En este fichero hay que tener en cuenta los permisos del usuario que ejecuta el agente dado que puede haber problemas para acceder a ciertos datos."})})]}),"\n",(0,a.jsx)(n.h2,{id:"chuleta-de-comandos-para-telegraf",children:"Chuleta de comandos para Telegraf"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"telegraf --config /etc/telegraf/telegraf.conf --test\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"telegraf --config /etc/telegraf/telegraf.conf --debug\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart telegraf\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"journalctl -u telegraf -f\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"sudo systemctl status telegraf\n"})}),"\n",(0,a.jsx)(n.h2,{id:"opci\xf3n-compatible-con-telegrafconf",children:"Opci\xf3n compatible con telegraf.conf"}),"\n",(0,a.jsxs)(n.p,{children:["Configuraci\xf3n de ",(0,a.jsx)(n.strong,{children:"telegraf"})," para almacenar en ",(0,a.jsx)(n.strong,{children:"conf.d"})," en compatibilidad con el fichero\n",(0,a.jsx)(n.strong,{children:"telegraf.conf"}),"."]}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:(0,a.jsx)(n.p,{children:"Fichero de configuraci\xf3n"})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'[agent]\n  interval = "5s"\n  debug = true\n\n[[outputs.file]]\n  files = ["stdout"]\n  data_format = "influx"\n\n[[inputs.mqtt_consumer]]\n  servers = ["tcp://192.168.56.106:1883"]\n  topics = ["#"]\n  data_format = "json"\n  topic_tag = "topic"\n'})})]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>i});var s=r(6540);const a={},t=s.createContext(a);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);
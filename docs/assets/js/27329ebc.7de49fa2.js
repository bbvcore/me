"use strict";(self.webpackChunkmydocs=self.webpackChunkmydocs||[]).push([[9182],{1808:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"OT/Pr\xe1cticas/cross-compilation","title":"Cross Compilation","description":"9881; Cross compilation","source":"@site/docs/OT/Pr\xe1cticas/cross-compilation.md","sourceDirName":"OT/Pr\xe1cticas","slug":"/OT/Pr\xe1cticas/cross-compilation","permalink":"/me/docs/docs/OT/Pr\xe1cticas/cross-compilation","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/OT/Pr\xe1cticas/cross-compilation.md","tags":[],"version":"current","frontMatter":{"title":"Cross Compilation","sidebar_id":1},"sidebar":"tutorialSidebar","previous":{"title":"Liber\xedas en Siemens IoT2040","permalink":"/me/docs/docs/OT/Pr\xe1cticas/siemens-iot-2040"},"next":{"title":"Replica del entorno Siemens IoT2040","permalink":"/me/docs/docs/OT/Pr\xe1cticas/replicacion-env-siemens"}}');var r=a(4848),l=a(8453);const s={title:"Cross Compilation",sidebar_id:1},o="\u2699 Cross compilation",c={},t=[{value:"\u21aaSituaci\xf3n previa",id:"situaci\xf3n-previa",level:2},{value:"\ud83d\udcc1 Librer\xedas para cross-compilar",id:"-librer\xedas-para-cross-compilar",level:2},{value:"\u2192 Librer\xeda lxml",id:"-librer\xeda-lxml",level:3},{value:"Descarga",id:"descarga",level:4},{value:"Configuraci\xf3n de flags",id:"configuraci\xf3n-de-flags",level:4},{value:"Compilaci\xf3n",id:"compilaci\xf3n",level:4},{value:"Fichero generado",id:"fichero-generado",level:4},{value:"\u2192 Librer\xeda cryptography",id:"-librer\xeda-cryptography",level:3},{value:"Configuraci\xf3n de flags",id:"configuraci\xf3n-de-flags-1",level:4},{value:"\ud83d\udee0 Instalaci\xf3n de todas las librer\xedas",id:"-instalaci\xf3n-de-todas-las-librer\xedas",level:2},{value:"\ud83d\udcceAnexo",id:"anexo",level:2},{value:"\u2714 Opci\xf3n 1: Intentar encontrar directamente la librer\xeda",id:"-opci\xf3n-1-intentar-encontrar-directamente-la-librer\xeda",level:3},{value:"\u2714 Opci\xf3n 2: Compilar la librer\xeda",id:"-opci\xf3n-2-compilar-la-librer\xeda",level:3},{value:"\u2705 Copiar la librer\xeda",id:"-copiar-la-librer\xeda",level:4}];function d(e){const n={admonition:"admonition",code:"code",div:"div",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components},{Details:a}=n;return a||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"-cross-compilation",children:"\u2699 Cross compilation"})}),"\n",(0,r.jsxs)(n.p,{children:["Es muy importante tener en cuenta el ",(0,r.jsx)(n.strong,{children:"OS"})," que se va a usar, con Ubuntu sufr\xed m\xe1s problemas que con ",(0,r.jsx)(n.strong,{children:"Mint Debian"}),", esto es debido a que ",(0,r.jsx)(n.strong,{children:"Ubuntu"})," incorpora m\xe1s ",(0,r.jsx)(n.strong,{children:"flags de compilaci\xf3n modernos"})," ",(0,r.jsx)(n.em,{children:"(como -fcf-protection)"})," que genera m\xe1s incompatibilidades con i586, por ello recomiendo usar una distribuci\xf3n ",(0,r.jsx)(n.strong,{children:"Debian/RHEL"}),"."]}),"\n",(0,r.jsxs)(n.div,{children:[(0,r.jsx)(n.p,{children:"Para arquitecturas antiguas es importante aplicar los siguientes criterios:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Usar ",(0,r.jsx)(n.strong,{children:"--no-binary"})," para paquetes con extensiones C"]}),"\n",(0,r.jsxs)(n.li,{children:["Simplificar los flags en las arquitecturas antiguas ",(0,r.jsx)(n.em,{children:"(-m32 -march=i586 -Os)"})]}),"\n"]})]}),"\n",(0,r.jsx)(n.h2,{id:"situaci\xf3n-previa",children:"\u21aaSituaci\xf3n previa"}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["La situaci\xf3n previa se puede consultar en esta ",(0,r.jsx)("a",{href:"s7comm.md",children:"entrada"}),"."]})}),"\n",(0,r.jsx)(n.p,{children:"Previamente se hab\xedan descargado dependencias puras que no necesitaban compilaci\xf3n"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pip download --only-binary=:all: --platform manylinux1_i586 --python-version 38 python-dateutil==2.8.2 pytz==2023.3 six==1.16.0\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Tambi\xe9n se descarg\xf3 la librer\xeda ",(0,r.jsx)(n.strong,{children:"OPCUA"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pip download opcua==0.98.12 --platform any\n"})}),"\n",(0,r.jsx)(n.p,{children:"Partiendo de esa situaci\xf3n, se van a obtener las librer\xedas que necesitan compilaci\xf3n, para ello hay que preparar el sistema operativo."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo apt update && sudo apt install -y \\\n    python3-dev \\\n    libxml2-dev \\\n    libxslt1-dev \\\n    zlib1g-dev \\\n    libssl-dev\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-librer\xedas-para-cross-compilar",children:"\ud83d\udcc1 Librer\xedas para cross-compilar"}),"\n",(0,r.jsx)(n.h3,{id:"-librer\xeda-lxml",children:"\u2192 Librer\xeda lxml"}),"\n",(0,r.jsx)(n.h4,{id:"descarga",children:"Descarga"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pip download --no-binary lxml lxml==4.9.3`\n"})}),"\n",(0,r.jsx)(n.h4,{id:"configuraci\xf3n-de-flags",children:"Configuraci\xf3n de flags"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'CFLAGS="-m32 -march=pentium -mtune=generic -Os -fno-stack-protector" \\\n'})}),"\n",(0,r.jsx)(n.h4,{id:"compilaci\xf3n",children:"Compilaci\xf3n"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"python3 setup.py bdist_wheel --plat-name=linux_i586\n"})}),"\n",(0,r.jsx)(n.h4,{id:"fichero-generado",children:"Fichero generado"}),"\n",(0,r.jsxs)(n.p,{children:["Accesible desde ",(0,r.jsx)(n.strong,{children:"/dist"})," con la extensi\xf3n *.whl, entonces se procede a copiarlo para el sistema destino."]}),"\n",(0,r.jsx)(n.h3,{id:"-librer\xeda-cryptography",children:"\u2192 Librer\xeda cryptography"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pip download --no-binary cryptography cryptography==3.4.8 \n"})}),"\n",(0,r.jsx)(n.h4,{id:"configuraci\xf3n-de-flags-1",children:"Configuraci\xf3n de flags"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'export CFLAGS="-m32 -march=i586 -fno-stack-protector"\nexport LDFLAGS="-m32"\nexport CARGO_TARGET_I586_UNKNOWN_LINUX_GNU_LINKER="i686-linux-gnu-gcc"\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"python3 setup.py bdist_wheel --plat-name=linux_i586\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["Puede fallar debido a la falta de ",(0,r.jsx)(n.strong,{children:"RUST"})]})}),"\n",(0,r.jsxs)(a,{children:[(0,r.jsx)("summary",{children:(0,r.jsxs)(n.p,{children:["Soluci\xf3n error con ",(0,r.jsx)("b",{children:"RUST"})]})}),(0,r.jsx)(n.p,{children:"Como el entorno de ejecuci\xf3n recomienda el uso de un entorno virtual se va a proceder a realizarlo de esa forma."}),(0,r.jsx)(n.p,{children:"python3 -m venv /tmp/crypto_build\nsource /tmp/crypto_build/bin/activate\npip wheel cryptography --no-binary cryptography -w ./wheels"})]}),"\n",(0,r.jsx)(n.h2,{id:"-instalaci\xf3n-de-todas-las-librer\xedas",children:"\ud83d\udee0 Instalaci\xf3n de todas las librer\xedas"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"python3 -m pip install --user --no-index --find-links=/home/root/ six-*.whl python_dateutil-*.whl  pytz-*.whl lxml-*.whl cryptography-*.whl opcua-0.98.12-py3-none-any.whl\n"})}),"\n",(0,r.jsx)(n.h2,{id:"anexo",children:"\ud83d\udcceAnexo"}),"\n",(0,r.jsxs)(n.p,{children:["Tuve un problema con la librer\xeda lxml debido a que no era adecuada para la ",(0,r.jsx)(n.strong,{children:"versi\xf3n python 3.8"})," que es la que usa el ",(0,r.jsx)(n.strong,{children:"Yocto en el Siemens IoT"}),", entonces procedo a conseguir de nuevo esa librer\xeda adecuada esta vez para el dispositivo OT."]}),"\n",(0,r.jsx)(n.h3,{id:"-opci\xf3n-1-intentar-encontrar-directamente-la-librer\xeda",children:"\u2714 Opci\xf3n 1: Intentar encontrar directamente la librer\xeda"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pip download lxml==4.9.3 --platform manylinux1_i586 --python-version 38 --only-binary=:all:\n"})}),"\n",(0,r.jsx)(n.h3,{id:"-opci\xf3n-2-compilar-la-librer\xeda",children:"\u2714 Opci\xf3n 2: Compilar la librer\xeda"}),"\n",(0,r.jsx)(n.p,{children:"Hay varias opciones, como me daba problemas con la versi\xf3n de python, voy a probar una soluci\xf3n limpia que es usar docker."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'sudo apt install docker.io\ndocker run --platform linux/386 -it --rm \\\n  -v "$PWD":/build \\\n  python:3.8-bookworm \\\n  bash -c "apt update && apt install -y libxml2-dev libxslt1-dev && \\\n  pip wheel lxml==4.9.3 --no-binary lxml -w /build && \\\n  auditwheel repair /build/lxml-*.whl --plat linux_i586 -w /build"\n'})}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsx)(n.p,{children:'-v "$PWD":/build: Vincula directorio actual a /build en el contenedor.\n-rm: Elimina el contenedor al terminar (pero no los ficheros).'}),(0,r.jsxs)(n.div,{children:[(0,r.jsx)(n.h4,{id:"-copiar-la-librer\xeda",children:"\u2705 Copiar la librer\xeda"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"scp *.whl root@192.168.200.1:/home/root\n"})})]})]})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>o});var i=a(6540);const r={},l=i.createContext(r);function s(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);
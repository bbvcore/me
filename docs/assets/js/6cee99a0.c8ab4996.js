"use strict";(self.webpackChunkmydocs=self.webpackChunkmydocs||[]).push([[8961],{3083:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"OT/Ciberseguridad/Servicios/suricata","title":"Suricata","description":"Instalaci\xf3n","source":"@site/docs/OT/Ciberseguridad/Servicios/suricata.md","sourceDirName":"OT/Ciberseguridad/Servicios","slug":"/OT/Ciberseguridad/Servicios/suricata","permalink":"/me/docs/docs/OT/Ciberseguridad/Servicios/suricata","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/OT/Ciberseguridad/Servicios/suricata.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Suricata"},"sidebar":"tutorialSidebar","previous":{"title":"Open PLC","permalink":"/me/docs/docs/OT/Ciberseguridad/Servicios/open-plc"}}');var r=s(4848),a=s(8453);const o={sidebar_position:4,title:"Suricata"},l=void 0,c={},t=[{value:"Instalaci\xf3n",id:"instalaci\xf3n",level:2},{value:"Desde los repositorios de las distros Debian/Ubuntu",id:"desde-los-repositorios-de-las-distros-debianubuntu",level:3},{value:"Desde el repositorio propio de Suricata",id:"desde-el-repositorio-propio-de-suricata",level:3},{value:"Verificar el resultado de la instalaci\xf3n",id:"verificar-el-resultado-de-la-instalaci\xf3n",level:3},{value:"Ficheros importantes",id:"ficheros-importantes",level:2},{value:"Ejecuci\xf3n como IDS",id:"ejecuci\xf3n-como-ids",level:2},{value:"Test de funcionamiento",id:"test-de-funcionamiento",level:3},{value:"Funcionamiento correcto",id:"funcionamiento-correcto",level:3},{value:"Regas Emerging Threats",id:"regas-emerging-threats",level:2},{value:"Ver alertas",id:"ver-alertas",level:2},{value:"Comprobaciones",id:"comprobaciones",level:2},{value:"Ejecuci\xf3n en primer plano",id:"ejecuci\xf3n-en-primer-plano",level:3},{value:"Simular tr\xe1fico malicioso",id:"simular-tr\xe1fico-malicioso",level:3},{value:"Leer logs",id:"leer-logs",level:3},{value:"Inspeccionar eve.json",id:"inspeccionar-evejson",level:3},{value:"JQ",id:"jq",level:4},{value:"Eve.JSON",id:"evejson",level:4},{value:"Crear reglas propias en Suricata",id:"crear-reglas-propias-en-suricata",level:2},{value:"Reglas HTTP",id:"reglas-http",level:3},{value:"Regla para peticiones HTTP",id:"regla-para-peticiones-http",level:4},{value:"Comprobaci\xf3n del funcionamiento de la regla",id:"comprobaci\xf3n-del-funcionamiento-de-la-regla",level:5},{value:"Regla para respuestas HTTP",id:"regla-para-respuestas-http",level:4},{value:"Anexo redes [comando ip]",id:"anexo-redes-comando-ip",level:2},{value:"Comprobaciones de namespaces (espacios de red)",id:"comprobaciones-de-namespaces-espacios-de-red",level:3}];function d(e){const n={admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"instalaci\xf3n",children:"Instalaci\xf3n"}),"\n",(0,r.jsx)(n.p,{children:"La instalaci\xf3n, como muchas veces pasa, se puede realizar de diferentes formas, aqu\xed se muestran las dos m\xe1s habituales."}),"\n",(0,r.jsx)(n.h3,{id:"desde-los-repositorios-de-las-distros-debianubuntu",children:"Desde los repositorios de las distros Debian/Ubuntu"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo apt install suricata -y\n"})}),"\n",(0,r.jsx)(n.h3,{id:"desde-el-repositorio-propio-de-suricata",children:"Desde el repositorio propio de Suricata"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo add-apt-repository ppa:oisf/suricata-stable\nsudo apt update\nsudo apt install -y suricata\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Si no se dispone de ",(0,r.jsx)(n.strong,{children:"add-apt-repository"})," en la distribuci\xf3n se puede instalar de la siguiente forma."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo apt install software-properties-common\n"})}),"\n",(0,r.jsx)(n.h3,{id:"verificar-el-resultado-de-la-instalaci\xf3n",children:"Verificar el resultado de la instalaci\xf3n"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"suricata --build-info\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)("b",{children:"Resultado"})," del despligue de ",(0,r.jsx)("b",{children:"Suricata"})]})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500[\u2717]\u2500[borja@parrot]\u2500[~]\n\u2514\u2500\u2500\u257c $suricata --build info\nThis is Suricata version 6.0.10 RELEASE\nFeatures: NFQ PCAP_SET_BUFF AF_PACKET HAVE_PACKET_FANOUT LIBCAP_NG LIBNET1.1 HAVE_HTP_URI_NORMALIZE_HOOK PCRE_JIT HAVE_NSS HAVE_LUA HAVE_LUAJIT HAVE_LIBJANSSON TLS TLS_C11 MAGIC RUST \nSIMD support: none\nAtomic intrinsics: 1 2 4 8 byte(s)\n64-bits, Little-endian architecture\nGCC version 12.2.0, C version 201112\ncompiled with _FORTIFY_SOURCE=2\nL1 cache line size (CLS)=64\nthread local storage method: _Thread_local\ncompiled with LibHTP v0.5.42, linked against LibHTP v0.5.42\n"})})]}),"\n",(0,r.jsx)(n.h2,{id:"ficheros-importantes",children:"Ficheros importantes"}),"\n",(0,r.jsx)(n.p,{children:"Una vez instalado Suricata hay una serie de ficheros a tener en cuenta:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"suricata.yaml"}),": es el archivo principal de configuraci\xf3n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/etc/suricata/suricata.yaml\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)(n.p,{children:"Extracto del contenido del fichero suricata.yaml"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'# Suricata configuration file. In addition to the comments describing all\n# options in this file, full documentation can be found at:\n# https://suricata.readthedocs.io/en/latest/configuration/suricata-yaml.html\n#\n# This configuration file generated by:\n#     Suricata 6.0.10\n\n##\n## Step 1: Inform Suricata about your network\n##\n\nvars:\n  # more specific is better for alert accuracy and performance\n  address-groups:\n    HOME_NET: "[192.168.0.0/16,10.0.0.0/8,172.16.0.0/12]"\n    #HOME_NET: "[192.168.0.0/16]"\n    #HOME_NET: "[10.0.0.0/8]"\n    #HOME_NET: "[172.16.0.0/12]"\n    #HOME_NET: "any"\n\n'})})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Logs"}),": Suricata tiene sus propios logs dentro del directorio habitual en GNU/Linux."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/var/log/suricata\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Principales logs",type:"info",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"eve.json"}),"\n",(0,r.jsx)(n.li,{children:"fast.log"}),"\n",(0,r.jsx)(n.li,{children:"stats.log"}),"\n",(0,r.jsx)(n.li,{children:"suricata.log"}),"\n"]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reglas"}),": conjunto de reglas locales"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/etc/suricata/rules\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Aqu\xed se pueden encontrar ",(0,r.jsx)(n.strong,{children:"conjuntos de reglas"})," ",(0,r.jsx)(n.em,{children:"agrupadas"})," por tipo de ",(0,r.jsx)(n.strong,{children:"protocolo"}),", destacando algunos como: ",(0,r.jsx)(n.em,{children:"dhcp-events.rules, files.rules, http2-events.rules, modbus-events.rules, mqtt-events.rules, smb-events.rules, tls-events.rules, ssh-events.rules o smtp-events.rules"}),"."]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsxs)(n.p,{children:["Ejemplos de conjuntos de reglas para el protocolo ",(0,r.jsx)("b",{children:"modbus"}),"."]})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\u250c\u2500[borja@parrot]\u2500[/etc/suricata/rules]\n\u2514\u2500\u2500\u257c $cat modbus-events.rules\n# Modbus Protocol version field is incorrect (Modbus version = 0)\nalert modbus any any -> any any (msg:"SURICATA Modbus invalid Protocol version"; app-layer-event:modbus.invalid_protocol_id; classtype:protocol-command-decode; sid:2250001; rev:2;)\n# Response (answer) we didn\'t see a Request for. Could be packet loss.\nalert modbus any any -> any any (msg:"SURICATA Modbus unsolicited response"; app-layer-event:modbus.unsolicited_response; classtype:protocol-command-decode; sid:2250002; rev:2;)\n# Malformed request or response. Malformed means length field is wrong\nalert modbus any any -> any any (msg:"SURICATA Modbus invalid Length"; app-layer-event:modbus.invalid_length; classtype:protocol-command-decode; sid:2250003; rev:2;)\n# Unit identifier field is incorrect\nalert modbus any any -> any any (msg:"SURICATA Modbus invalid Unit Identifier"; app-layer-event:modbus.invalid_unit_identifier; classtype:protocol-command-decode; sid:2250004; rev:2;)\n# Modbus Function code is incorrect\nalert modbus any any -> any any (msg:"SURICATA Modbus invalid Function code"; app-layer-event:modbus.invalid_function_code; classtype:protocol-command-decode; sid:2250005; rev:2;)\n# Modbus Request/Response value field is incorrect\nalert modbus any any -> any any (msg:"SURICATA Modbus invalid Value"; app-layer-event:modbus.invalid_value; classtype:protocol-command-decode; sid:2250006; rev:2;)\n# Modbus Expception code is incorrect\nalert modbus any any -> any any (msg:"SURICATA Modbus Exception code invalid"; flow:to_client; app-layer-event:modbus.invalid_exception_code; classtype:protocol-command-decode; sid:2250007; rev:2;)\n# Value field in Modbus Response does not match with Modbus Request\nalert modbus any any -> any any (msg:"SURICATA Modbus Data mismatch"; flow:to_client; app-layer-event:modbus.value_mismatch; classtype:protocol-command-decode; sid:2250008; rev:2;)\n# Request Flood Detected\nalert modbus any any -> any any (msg:"SURICATA Modbus Request flood detected"; flow:to_server; app-layer-event:modbus.flooded; classtype:protocol-command-decode; sid:2250009; rev:2;)\n\n'})})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"suricata-update"}),": fichero de configuraci\xf3n para ",(0,r.jsx)(n.strong,{children:"suricata-update"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/etc/suricata/update.yaml\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ejecuci\xf3n-como-ids",children:"Ejecuci\xf3n como IDS"}),"\n",(0,r.jsx)(n.p,{children:"Remplazar la interfaz por el nombre correspondiente de la interfaz escogida."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo suricata -c /etc/suricata/suricata.yaml -i eth0\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsxs)(n.p,{children:["Lanzamiento de ",(0,r.jsx)("b",{children:"Suricata"})," sin especificar reglas"]})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500[borja@parrot]\u2500[/etc/suricata/rules]\n\u2514\u2500\u2500\u257c $sudo suricata -c /etc/suricata/suricata.yaml -i wlx3c52a1c35918\n[sudo] contrase\xf1a para trabajo: \n14/4/2025 -- 11:40:42 - <Notice> - This is Suricata version 6.0.10 RELEASE running in SYSTEM mode\n14/4/2025 -- 11:40:42 - <Warning> - [ERRCODE: SC_ERR_NO_RULES(42)] - No rule files match the pattern /etc/suricata/rules/suricata.rules\n14/4/2025 -- 11:40:42 - <Warning> - [ERRCODE: SC_ERR_NO_RULES_LOADED(43)] - 1 rule files specified, but no rules were loaded!\n14/4/2025 -- 11:40:42 - <Notice> - all 12 packet processing threads, 4 management threads initialized, engine started.\n"})})]}),"\n",(0,r.jsxs)(n.p,{children:["Existen reglas pero no las carg\xf3 ",(0,r.jsx)(n.strong,{children:"Suricata"})," por ello se ha de revisar la configuraci\xf3n del fichero ",(0,r.jsx)(n.strong,{children:"yaml"}),", y comprobar en la secci\xf3n ",(0,r.jsx)(n.strong,{children:"rule-files"})," que apuntan correctamente al destino."]}),"\n",(0,r.jsxs)(n.p,{children:["Entonces en la secci\xf3n mencionada se a\xf1aden todas las reglas que existan en el directorio ",(0,r.jsx)(n.strong,{children:"/etc/suricata/rules"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"rule-files:\n  - app-layer-events.rules\n  - dns-events.rules\n  - ipsec-events.rules\n  - nfs-events.rules\n  - ssh-events.rules\n  - decoder-events.rules\n  - files.rules\n  - kerberos-events.rules\n  - ntp-events.rules\n  - stream-events.rules\n  - dhcp-events.rules\n  - http2-events.rules\n  - modbus-events.rules\n  - smb-events.rules\n  - tls-events.rules\n  - dnp3-events.rules\n  - http-events.rules\n  - mqtt-events.rules\n  - smtp-events.rules\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Comprobar la ruta en suricata.yaml",type:"warning",children:(0,r.jsxs)(n.p,{children:["Comprobar en el fichero de configuraci\xf3n ",(0,r.jsx)(n.strong,{children:"suricata.yaml"})," la ruta por defecto de las reglas, ya que puede no ser ",(0,r.jsx)(n.strong,{children:"/etc/suricata/rules"}),". La variable a buscar en el fichero es ",(0,r.jsx)(n.strong,{children:"default-rule-path"}),"."]})}),"\n",(0,r.jsxs)(n.p,{children:["A continuaci\xf3n se reinicia ",(0,r.jsx)(n.strong,{children:"Suricata"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo systemctl restart suricata\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"warning",children:[(0,r.jsx)(n.mdxAdmonitionTitle,{}),(0,r.jsxs)(n.p,{children:['Por defecto los m\xf3dulos http2, modbus y dnp3 vienen como "enable',":no",'" y hay que ponerlos a "enable',":yes",'" para que ',(0,r.jsx)(n.strong,{children:"Suricata"})," arranque bien."]})]}),"\n",(0,r.jsx)(n.h3,{id:"test-de-funcionamiento",children:"Test de funcionamiento"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500[\u2717]\u2500[borjao@parrot]\u2500[/etc/suricata/rules]\n\u2514\u2500\u2500\u257c $sudo suricata -T -c /etc/suricata/suricata.yaml\n[sudo] contrase\xf1a para borja: \n14/4/2025 -- 12:23:23 - <Info> - Running suricata under test mode\n14/4/2025 -- 12:23:23 - <Notice> - This is Suricata version 6.0.10 RELEASE running in SYSTEM mode\n14/4/2025 -- 12:23:23 - <Notice> - Configuration provided was successfully loaded. Exiting.\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"funcionamiento-correcto",children:"Funcionamiento correcto"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500[borja@parrot]\u2500[/etc/suricata/rules]\n\u2514\u2500\u2500\u257c $sudo suricata -c /etc/suricata/suricata.yaml -i wlx3c52a1c35918\n[sudo] contrase\xf1a para trabajo: \n14/4/2025 -- 12:26:33 - <Notice> - This is Suricata version 6.0.10 RELEASE running in SYSTEM mode\n14/4/2025 -- 12:26:33 - <Notice> - all 12 packet processing threads, 4 management threads initialized, engine started.\n\n"})}),"\n",(0,r.jsx)(n.h2,{id:"regas-emerging-threats",children:"Regas Emerging Threats"}),"\n",(0,r.jsx)(n.p,{children:"Un conjunto de reglas r\xe1pidas de a\xf1adir a Suricata desarrolladas por la comunidad de Emerging Threats,"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo apt install suricata-update\nsudo suricata-update\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ver-alertas",children:"Ver alertas"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo tail -f /var/log/suricata/fast.log\n"})}),"\n",(0,r.jsx)(n.h2,{id:"comprobaciones",children:"Comprobaciones"}),"\n",(0,r.jsx)(n.h3,{id:"ejecuci\xf3n-en-primer-plano",children:"Ejecuci\xf3n en primer plano"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo suricata -c /etc/suricata/suricata.yaml -i eth10 --init-errors-fatal\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsx)(n.mdxAdmonitionTitle,{}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"c"}),": indica el path del fichero de configuraci\xf3n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"i"}),": configura la interfaz en la que va a escuchar"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"--init-errors-fatal"}),": muestra los errores fatales en el lanzamiento de Suricata."]}),"\n"]}),(0,r.jsx)(n.h3,{id:"simular-tr\xe1fico-malicioso",children:"Simular tr\xe1fico malicioso"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"curl http://testmyids.com\n"})}),(0,r.jsx)(n.admonition,{title:"Web de pruebas",type:"tip",children:(0,r.jsxs)(n.p,{children:["La ",(0,r.jsx)(n.strong,{children:"URL"})," ",(0,r.jsx)(n.em,{children:"testmyids.com"}),' sirve para probar si el IDS/IPS est\xe1 bien configurado, en este caso simula respuesta del comando "id" con lo cu\xe1l parece haber tenido \xe9xito una vulnerabilidad y deber\xeda de mostrar una alerta el IDS/IPS.']})})]}),"\n",(0,r.jsx)(n.h3,{id:"leer-logs",children:"Leer logs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"tail -f /var/log/suricata/fast.log\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsx)(n.mdxAdmonitionTitle,{}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"f"}),": sigue al descriptor del fichero, aunque se renombre el fichero."]}),"\n"]})]}),"\n",(0,r.jsx)(n.h3,{id:"inspeccionar-evejson",children:"Inspeccionar eve.json"}),"\n",(0,r.jsx)(n.h4,{id:"jq",children:"JQ"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"JQ"})," sirve para procesar JSON y llevar a cabo varias operaciones, como el embellecimiento de los datos."]}),"\n",(0,r.jsx)(n.admonition,{title:"Embellece tu JSON",type:"tip",children:(0,r.jsxs)(n.p,{children:["-",(0,r.jsx)("a",{href:"https://jqlang.org/",children:"Enbellecedor JSON"})]})}),"\n",(0,r.jsx)(n.p,{children:"Si no se encuentra instalado en el equipo es posible instalarlo de la siguiente forma en equipos Linux."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo apt install jq\n"})}),"\n",(0,r.jsx)(n.p,{children:"Un buen ejemplo para comprobar la legibilidad que ofrece esta utilidad es ejecutar los siguientes comandos desde una terminal y apreciar las enormes diferencias."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"cat eve.json # Se ver\xe1 un stream de datos dificilmente seguible\njq . eve.json # Se mostrar\xe1 una sucesi\xf3n de objetos JSON legibles\n"})}),"\n",(0,r.jsx)(n.h4,{id:"evejson",children:"Eve.JSON"}),"\n",(0,r.jsx)(n.p,{children:"Fichero principal que genera Suricata en formato JSON, en este fichero se pueden consultar los siguientes eventos:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Alertas"}),": consultando el tipo de evento de alerta, ",(0,r.jsx)(n.strong,{children:'"event_type":"alert"'}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Comprobar las conexiones de red"}),": a trav\xe9s del tipo de evento flujo,  ",(0,r.jsx)(n.strong,{children:'"event_type":"flow"'}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Posibilita el an\xe1lisis de protocolos como SSH, HTTP, TLS..."}),"\n",(0,r.jsx)(n.li,{children:"Informaci\xf3n sobre archivos detectados."}),"\n",(0,r.jsx)(n.li,{children:"Informaci\xf3n sobre los protocolos detectados."}),"\n",(0,r.jsx)(n.li,{children:"Consulta de los Logs."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"jq . /var/log/suricata/eve.json | less\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Este fichero ",(0,r.jsx)(n.strong,{children:"eve.json"})," es la base de ",(0,r.jsx)(n.strong,{children:"Suricata"})," para trabajar con varios sistemas como ",(0,r.jsx)(n.strong,{children:"ELK"})," o ",(0,r.jsx)(n.strong,{children:"Grafana"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"crear-reglas-propias-en-suricata",children:"Crear reglas propias en Suricata"}),"\n",(0,r.jsx)(n.h3,{id:"reglas-http",children:"Reglas HTTP"}),"\n",(0,r.jsx)(n.p,{children:"Las reglas en suricata siguen una estructura determinada que es la siguiente:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"acci\xf3n protocolo src_ip src_port -> dst_ip dst_port (opciones)\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Par\xe1metros de las reglas",type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"acci\xf3n"}),": detectar un evento ",(0,r.jsx)(n.em,{children:"(alert, drop o reject)"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"protocolo"}),": el protocolo correspondiente ",(0,r.jsx)(n.em,{children:"(http, udp, icmp)"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"src_ip"}),": ip de origen"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"src_port"}),": puerto de origen"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"dst_ip"}),": ip de destino"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"dst_port"}),": puerto de destino"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"opciones"}),": opciones varias como mensajes, informaci\xf3n adicional, etc..."]}),"\n"]})}),"\n",(0,r.jsx)(n.p,{children:"En HTTP las caracter\xedsticas m\xe1s utilizadas en la parte de opciones son:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:['"msg',":text",'" texto del mensaje']}),"\n",(0,r.jsx)(n.li,{children:'"sid: number": ID \xfanico de las reglas, para personalizadas superior a 1000000.'}),"\n",(0,r.jsxs)(n.li,{children:['"classtype',":type",'": tipo aplicaci\xf3n']}),"\n",(0,r.jsxs)(n.li,{children:['"rev',":value",'" versi\xf3n de la regla, incrementa con las ediciones']}),"\n",(0,r.jsx)(n.li,{children:'"flow: to_server, established": paquete hac\xeda el servidor, conexi\xf3n establecida'}),"\n",(0,r.jsx)(n.li,{children:'"flow: to_client, established": paquete hac\xeda el cliente, conexi\xf3n establecida'}),"\n",(0,r.jsx)(n.li,{children:'"flow: established", solo conexiones establecidas'}),"\n",(0,r.jsx)(n.li,{children:'"http.method": m\xe9todo'}),"\n",(0,r.jsx)(n.li,{children:'"http.uri": ruta del recurso'}),"\n",(0,r.jsx)(n.li,{children:'"http.host": nombre del dominio'}),"\n",(0,r.jsx)(n.li,{children:'"http.user_agent": el agente (curl, mozilla)'}),"\n",(0,r.jsx)(n.li,{children:'"http.request_line": l\xednea de la petici\xf3n (VerboHTTP /url HTTP/version)'}),"\n",(0,r.jsxs)(n.li,{children:['"content',":cadena",'": una cadena literal a buscar:']}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"'nocase': no case sensitive"}),"\n",(0,r.jsxs)(n.li,{children:["'offset",":x",";': rangos de b\xfasqueda"]}),"\n",(0,r.jsxs)(n.li,{children:["'depth",":y",";': rangos de b\xfasqueda"]}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'\'pcre:"/expr/" : expresiones regulares tipo PCRE'}),"\n",(0,r.jsxs)(n.li,{children:["'threshold",":type"," limit, track by_src, count number, seconds number' alerta por IP cada X tiempo."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"regla-para-peticiones-http",children:"Regla para peticiones HTTP"}),"\n",(0,r.jsx)(n.p,{children:"Establecimiento de una regla propia b\xe1sica de Suricata para comprobar cualquier tipo de petici\xf3n HTTP que se produzca."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'alert http any any -> any any (msg:"HTTP GET Request Detected"; flow:to_server,established; http.method; content:"GET"; classtype:web-application-activity; sid:1000001; rev:1;)\n'})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)(n.p,{children:"Explicaci\xf3n de la estrutura de la regla aplicada"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"- Tipo de acci\xf3n: alert, se notifica una alerta\n- Protocolo: http.\n- any: cualquier IP origen\n- any: cualquier PORT origen\n- any: cualquier IP destino\n- any: cualquier PORT destino\n- (): incluye las opciones. Condiciones ESTRICTAS para que la alerta se dispare.\n"})})]}),"\n",(0,r.jsx)(n.p,{children:"Explicaci\xf3n de las opciones:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"msg: mensaje que aparecer\xe1 en el LOG cuando la regla se dispare."}),"\n",(0,r.jsx)(n.li,{children:"flow: to_server, stablished: flujo de datos, paquete de cliente a servidor  y conexi\xf3n establecida."}),"\n",(0,r.jsx)(n.li,{children:"http.method: se indica la b\xfasqueda en el campo http.method."}),"\n",(0,r.jsx)(n.li,{children:'content:"get", busca GET en la cabecera HTTP'}),"\n",(0,r.jsx)(n.li,{children:"classtype:web-application-activity: clasifica la alerta en la categor\xeda correspondiente."}),"\n",(0,r.jsx)(n.li,{children:"SID: idnetificador \xfanico de la regla"}),"\n",(0,r.jsx)(n.li,{children:"rev1: versi\xf3n de la regla, cada vez que se cambi\xe9 la regla se debe de incrementar."}),"\n"]}),"\n",(0,r.jsx)(n.h5,{id:"comprobaci\xf3n-del-funcionamiento-de-la-regla",children:"Comprobaci\xf3n del funcionamiento de la regla"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo tail -f /var/log/suricata/fast.log \n04/16/2025-09:35:55.545375  [**] [1:1000001:1] HTTP GET Request Detected [**] [Classification: access to a potentially vulnerable web application] [Priority: 2] {TCP} 10.0.2.15:52994 -> 193.110.128.199:80\n"})}),"\n",(0,r.jsx)(n.h4,{id:"regla-para-respuestas-http",children:"Regla para respuestas HTTP"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'alert http any any -> any any (msg:"HTTP 200 OK Response Detected"; flow:to_client,established; http.response_line; content:"200 OK"; classtype:successful-user; sid:1000002; rev:1;)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"anexo-redes-comando-ip",children:"Anexo redes [comando ip]"}),"\n",(0,r.jsx)(n.h3,{id:"comprobaciones-de-namespaces-espacios-de-red",children:"Comprobaciones de namespaces (espacios de red)"}),"\n",(0,r.jsxs)(n.p,{children:["Obtener el UUID con el par\xe1metro ",(0,r.jsx)(n.strong,{children:"netns"})," que sirve para averiguar un ",(0,r.jsx)(n.strong,{children:"network namespace"})," ",(0,r.jsx)(n.em,{children:"(espacio de red aislado, como en la contenerizaci\xf3n)"}),", entonces desde un host se puede interaccionar con estos espacios."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"ip netns list\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Ver informaci\xf3n de dicho ",(0,r.jsx)(n.strong,{children:"UUID"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"ip netns exec netns-35c7edf0-709c-0cb3-7bd1-216a73b9a29e ip a\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Par\xe1metros netns usados",type:"info",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ip netns exec"}),", comando a ejecutar en un espacio de red."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"netns-..."}),", identificador del nombre del espacio."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ip a"}),", el comando a ejecutar dentro del espacio de red."]}),"\n"]})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)(n.p,{children:"Resultado de la consulta"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500[borja@parrot]\u2500[/etc/suricata]\n\u2514\u2500\u2500\u257c $sudo ip netns exec netns-35c7edf0-709c-0cb3-7bd1-216a73b9a29e ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host proto kernel_lo \n       valid_lft forever preferred_lft forever\n2: eth0@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 6e:8f:28:bf:5d:4e brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.89.0.2/24 brd 10.89.0.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::6c8f:28ff:febf:5d4e/64 scope link proto kernel_ll \n       valid_lft forever preferred_lft forever\n\n"})})]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var i=s(6540);const r={},a=i.createContext(r);function o(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunkmydocs=self.webpackChunkmydocs||[]).push([[1961],{1676:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"Ciberseguridad/IDPS/open-canary","title":"Open Canary","description":"Se trata de un honeypot multiprotocolo descentralizado, implementado en Python. Es multiplataforma pero en GNU/Linux es donde se aprovecha todo sus potencial.","source":"@site/docs/Ciberseguridad/IDPS/open-canary.md","sourceDirName":"Ciberseguridad/IDPS","slug":"/Ciberseguridad/IDPS/open-canary","permalink":"/me/docs/docs/Ciberseguridad/IDPS/open-canary","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Ciberseguridad/IDPS/open-canary.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Open Canary"},"sidebar":"tutorialSidebar","previous":{"title":"IDS/IPS","permalink":"/me/docs/docs/Ciberseguridad/IDPS/ids-ips"},"next":{"title":"Suricata","permalink":"/me/docs/docs/Ciberseguridad/IDPS/suricata"}}');var r=o(4848),i=o(8453);const s={sidebar_position:2,title:"Open Canary"},c="Open Canary",t={},d=[{value:"Instalaci\xf3n",id:"instalaci\xf3n",level:2},{value:"Pasos previos",id:"pasos-previos",level:3},{value:"Actualizaci\xf3n del sistema",id:"actualizaci\xf3n-del-sistema",level:4},{value:"Instalaci\xf3n de Python",id:"instalaci\xf3n-de-python",level:4},{value:"Creaci\xf3n de entorno virtual",id:"creaci\xf3n-de-entorno-virtual",level:4},{value:"Activaci\xf3n",id:"activaci\xf3n",level:4},{value:"Instalar Open Canary",id:"instalar-open-canary",level:3},{value:"Configuraci\xf3n",id:"configuraci\xf3n",level:3},{value:"Creaci\xf3n de fichero de configuraci\xf3n",id:"creaci\xf3n-de-fichero-de-configuraci\xf3n",level:4},{value:"Acceso al fichero de configuraci\xf3n creado",id:"acceso-al-fichero-de-configuraci\xf3n-creado",level:4},{value:"Edici\xf3n del fichero de configuraci\xf3n",id:"edici\xf3n-del-fichero-de-configuraci\xf3n",level:4},{value:"Inicializaci\xf3n de Open Canary",id:"inicializaci\xf3n-de-open-canary",level:4},{value:"Comprobaci\xf3n de la ejecuci\xf3n de Open Canary",id:"comprobaci\xf3n-de-la-ejecuci\xf3n-de-open-canary",level:4},{value:"Consulta de logs",id:"consulta-de-logs",level:4},{value:"Como servicio de inicio",id:"como-servicio-de-inicio",level:4},{value:"Comprobaciones del funcionamiento",id:"comprobaciones-del-funcionamiento",level:2},{value:"Nmap a la IP del Open Canary",id:"nmap-a-la-ip-del-open-canary",level:3},{value:"Consulta de los logs de Open Canary",id:"consulta-de-los-logs-de-open-canary",level:4},{value:"Comprobaci\xf3n de acceso al ftp conectado a la m\xe1quina por SSH",id:"comprobaci\xf3n-de-acceso-al-ftp-conectado-a-la-m\xe1quina-por-ssh",level:3},{value:"Logs de dicho intento de acceso al FTP",id:"logs-de-dicho-intento-de-acceso-al-ftp",level:4}];function l(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{Details:o}=n;return o||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"open-canary",children:"Open Canary"})}),"\n",(0,r.jsxs)(n.p,{children:["Se trata de un ",(0,r.jsx)(n.strong,{children:"honeypot multiprotocolo"})," descentralizado, implementado en ",(0,r.jsx)(n.strong,{children:"Python"}),". Es multiplataforma pero en ",(0,r.jsx)(n.strong,{children:"GNU/Linux"})," es donde se aprovecha todo sus potencial."]}),"\n",(0,r.jsxs)(n.p,{children:["Los recursos que necesita para su ejecuci\xf3n son muy bajos lo cual permite que pueda ser instalado y operativo en equipos como ",(0,r.jsx)(n.strong,{children:"Raspberry Pi"}),"."]}),"\n",(0,r.jsx)(n.admonition,{title:"Repositorio del proyecto",type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)("a",{href:"https://github.com/thinkst/opencanary",children:"GitHub de Open Canary"}),"\n"]}),"\n"]})}),"\n",(0,r.jsx)(n.h2,{id:"instalaci\xf3n",children:"Instalaci\xf3n"}),"\n",(0,r.jsx)(n.h3,{id:"pasos-previos",children:"Pasos previos"}),"\n",(0,r.jsx)(n.p,{children:"Los pasos previos que hay que realizar est\xe1n orientados a configurar el equipo para la ejecuci\xf3n de Python."}),"\n",(0,r.jsx)(n.h4,{id:"actualizaci\xf3n-del-sistema",children:"Actualizaci\xf3n del sistema"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo apt update\n"})}),"\n",(0,r.jsx)(n.h4,{id:"instalaci\xf3n-de-python",children:"Instalaci\xf3n de Python"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo apt install -y python3 python3-pip python3.12-venv\n"})}),"\n",(0,r.jsx)(n.h4,{id:"creaci\xf3n-de-entorno-virtual",children:"Creaci\xf3n de entorno virtual"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"python3 -m venv opencanary-venv\n"})}),"\n",(0,r.jsx)(n.h4,{id:"activaci\xf3n",children:"Activaci\xf3n"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"~opencanary-venv/bin/$ source activate\n"})}),"\n",(0,r.jsx)(n.h3,{id:"instalar-open-canary",children:"Instalar Open Canary"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"pip install opencanary\n"})}),"\n",(0,r.jsx)(n.h3,{id:"configuraci\xf3n",children:"Configuraci\xf3n"}),"\n",(0,r.jsx)(n.p,{children:"Para la configuraci\xf3n del honeypot se requiere de la generaci\xf3n de un fichero de configuraci\xf3n y de su posterior edici\xf3n indicando los servicios activos a simular."}),"\n",(0,r.jsx)(n.h4,{id:"creaci\xf3n-de-fichero-de-configuraci\xf3n",children:"Creaci\xf3n de fichero de configuraci\xf3n"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"opencanaryd --copyconfig\n"})}),"\n",(0,r.jsx)(n.h4,{id:"acceso-al-fichero-de-configuraci\xf3n-creado",children:"Acceso al fichero de configuraci\xf3n creado"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/etc/opencanaryd/opencanay.conf  \n"})}),"\n",(0,r.jsx)(n.h4,{id:"edici\xf3n-del-fichero-de-configuraci\xf3n",children:"Edici\xf3n del fichero de configuraci\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:["Aqu\xed se a\xf1ade la configuraci\xf3n, en este caso para los servicios m\xe1s habituales, ",(0,r.jsx)(n.strong,{children:"FTP"}),", ",(0,r.jsx)(n.strong,{children:"Web"})," y ",(0,r.jsx)(n.strong,{children:"SSH"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'{\r\n    "device.node_id": "linux_server",\r\n    "ip.ignorelist": [],\r\n    "git.enabled": false,\r\n    "ftp.enabled": true,\r\n    "ftp.banner": "FTP server ready",\r\n    "http.enabled": true,\r\n    "http.banner": "Apache/2.2.22 (Ubuntu)",\r\n    "http.skin": "basicLogin",\r\n    "ssh.enabled": true,\r\n    "ssh.port": 22,\r\n    "ssh.version": "SSH-2.0-OpenSSH_7.2p2 Ubuntu-4ubuntu2.10"\r\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"inicializaci\xf3n-de-open-canary",children:"Inicializaci\xf3n de Open Canary"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"opencanaryd --start\n"})}),"\n",(0,r.jsx)(n.h4,{id:"comprobaci\xf3n-de-la-ejecuci\xf3n-de-open-canary",children:"Comprobaci\xf3n de la ejecuci\xf3n de Open Canary"}),"\n",(0,r.jsx)(n.p,{children:"Una vez inicializado se comprueba que el proceso est\xe1 en ejecuci\xf3n."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'ps -aux | grep "opencanaryd"\r\n\r\nroot        9280  0.0  1.2  79552 48976 ?        S    10:06   0:00 /home/lite/opencanary-venv/bin/python3 /home/lite/opencanary-venv/bin/twistd -y /home/lite/opencanary-venv/bin/opencanary.tac --pidfile /home/lite/opencanary-venv/bin/opencanaryd.pid --syslog --prefix=opencanaryd\r\nlite        9393  0.0  0.0  11804  2304 pts/1    S+   10:08   0:00 grep opencanaryd\n'})}),"\n",(0,r.jsx)(n.h4,{id:"consulta-de-logs",children:"Consulta de logs"}),"\n",(0,r.jsxs)(n.p,{children:["Visualizando los ",(0,r.jsx)(n.strong,{children:"logs"})," se comprueba que realmente esta funcionando el ",(0,r.jsx)(n.strong,{children:"honeypot"})," como deber\xeda."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'tail -f /var/tmp/opencanary.log\r\n\r\n{"dst_host": "", "dst_port": -1, "local_time": "2025-04-09 08:06:59.264629", "local_time_adjusted": "2025-04-09 10:06:59.264647", "logdata": {"msg": {"logdata": "Added service from class CanaryFTP in opencanary.modules.ftp to fake"}}, "logtype": 1001, "node_id": "opencanary-1", "src_host": "", "src_port": -1, "utc_time": "2025-04-09 08:06:59.264644"}\r\n{"dst_host": "", "dst_port": -1, "local_time": "2025-04-09 08:06:59.264839", "local_time_adjusted": "2025-04-09 10:06:59.264849", "logdata": {"msg": {"logdata": "Canary running!!!"}}, "logtype": 1001, "node_id": "opencanary-1", "src_host": "", "src_port": -1, "utc_time": "2025-04-09 08:06:59.264847"}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"como-servicio-de-inicio",children:"Como servicio de inicio"}),"\n",(0,r.jsxs)(n.p,{children:["Si se requiere de su ejecuci\xf3n desde el inicio de la carga del ",(0,r.jsx)(n.strong,{children:"OS"})," se debe de crear una unidad de servicio de ",(0,r.jsx)(n.strong,{children:"systemd"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[Unit]\r\nDescription=OpenCanary Honeypot\r\nAfter=network.target\r\n\r\n[Service]\r\nUser=root\r\nExecStart=/usr/local/bin/opencanaryd --start\r\nRestart=always\r\n\r\n[Install]\r\nWantedBy=multi-user.target\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Activaci\xf3n del servicio",type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"sudo systemctl d-reload"}),"\n",(0,r.jsx)(n.li,{children:"sudo systemctl enable opencanary"}),"\n",(0,r.jsx)(n.li,{children:"sudo systemctl start opencanary"}),"\n"]})}),"\n",(0,r.jsx)(n.h2,{id:"comprobaciones-del-funcionamiento",children:"Comprobaciones del funcionamiento"}),"\n",(0,r.jsx)(n.p,{children:"Una vez instalado y configurado se procede a comprobar su funcionamiento, para ello se realizan varias pruebas."}),"\n",(0,r.jsx)(n.h3,{id:"nmap-a-la-ip-del-open-canary",children:"Nmap a la IP del Open Canary"}),"\n",(0,r.jsxs)(n.p,{children:["La primera puerta es hacer un escaneo agresivo de la ",(0,r.jsx)(n.strong,{children:"IP"})," del ",(0,r.jsx)(n.strong,{children:"HoneyPot"})," y luego proceder a consultar los ",(0,r.jsx)(n.strong,{children:"logs"})," del mismo."]}),"\n",(0,r.jsxs)(o,{children:[(0,r.jsx)("summary",{children:(0,r.jsxs)(n.p,{children:["Ejecuci\xf3n de ",(0,r.jsx)("b",{children:"nmap"})," al host ",(0,r.jsx)("b",{children:"10.0.2.15"})]})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"nmap -A 10.0.2.15\r\n\r\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-09 10:23 CEST\r\nNmap scan report for lite-VirtualBox (10.0.2.15)\r\nHost is up (0.000044s latency).\r\nNot shown: 995 closed tcp ports (conn-refused)\r\nPORT    STATE SERVICE     VERSION\r\n21/tcp  open  ftp         vsftpd (before 2.0.8) or WU-FTPD\r\n22/tcp  open  ssh         OpenSSH 9.6p1 Ubuntu 3ubuntu13.9 (Ubuntu Linux; protocol 2.0)\r\n| ssh-hostkey: \r\n|   256 95:64:73:30:e2:42:fd:37:64:b3:6b:26:a4:71:49:a2 (ECDSA)\r\n|_  256 3d:03:91:34:9f:a8:41:29:20:77:3d:4a:52:b4:5a:ea (ED25519)\r\n25/tcp  open  smtp        Postfix smtpd\r\n|_ssl-date: TLS randomness does not represent time\r\n| ssl-cert: Subject: commonName=linux\r\n| Subject Alternative Name: DNS:linux\r\n| Not valid before: 2025-04-08T08:34:17\r\n|_Not valid after:  2035-04-06T08:34:17\r\n|_smtp-commands: linux, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING\r\n139/tcp open  netbios-ssn Samba smbd 4.6.2\r\n445/tcp open  netbios-ssn Samba smbd 4.6.2\r\nService Info: Host:  linux; OS: Linux; CPE: cpe:/o:linux:linux_kernel\r\n\r\nHost script results:\r\n|_nbstat: NetBIOS name: LINUX, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)\r\n| smb2-security-mode: \r\n|   3:1:1: \r\n|_    Message signing enabled but not required\r\n| smb2-time: \r\n|   date: 2025-04-09T08:23:14\r\n|_  start_date: N/A\r\n\n"})})]}),"\n",(0,r.jsx)(n.h4,{id:"consulta-de-los-logs-de-open-canary",children:"Consulta de los logs de Open Canary"}),"\n",(0,r.jsxs)(n.p,{children:["Una vez ha finalizado el escaneo del ",(0,r.jsx)(n.strong,{children:"host"})," se consultan los logs del ",(0,r.jsx)(n.strong,{children:"honeypot"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'tail -f /var/tmp/opencanary.log\r\n\r\n{"dst_host": "", "dst_port": -1, "local_time": "2025-04-09 08:06:59.264629", "local_time_adjusted": "2025-04-09 10:06:59.264647", "logdata": {"msg": {"logdata": "Added service from class CanaryFTP in opencanary.modules.ftp to fake"}}, "logtype": 1001, "node_id": "opencanary-1", "src_host": "", "src_port": -1, "utc_time": "2025-04-09 08:06:59.264644"}\r\n{"dst_host": "", "dst_port": -1, "local_time": "2025-04-09 08:06:59.264839", "local_time_adjusted": "2025-04-09 10:06:59.264849", "logdata": {"msg": {"logdata": "Canary running!!!"}}, "logtype": 1001, "node_id": "opencanary-1", "src_host": "", "src_port": -1, "utc_time": "2025-04-09 08:06:59.264847"}\r\n{"dst_host": "10.0.2.15", "dst_port": 21, "local_time": "2025-04-09 08:23:14.061297", "local_time_adjusted": "2025-04-09 10:23:14.061329", "logdata": {"PASSWORD": "IEUser@", "USERNAME": "anonymous"}, "logtype": 2000, "node_id": "opencanary-1", "src_host": "10.0.2.15", "src_port": 58572, "utc_time": "2025-04-09 08:23:14.061325"}\r\n{"dst_host": "10.0.2.15", "dst_port": 21, "local_time": "2025-04-09 08:23:14.061889", "local_time_adjusted": "2025-04-09 10:23:14.061899", "logdata": {"PASSWORD": "IEUser@", "USERNAME": "anonymous"}, "logtype": 2000, "node_id": "opencanary-1", "src_host": "10.0.2.15", "src_port": 58586, "utc_time": "2025-04-09 08:23:14.061896"}\r\n{"dst_host": "10.0.2.15", "dst_port": 21, "local_time": "2025-04-09 08:23:14.071571", "local_time_adjusted": "2025-04-09 10:23:14.071592", "logdata": {"PASSWORD": "IEUser@", "USERNAME": "anonymous"}, "logtype": 2000, "node_id": "opencanary-1", "src_host": "10.0.2.15", "src_port": 58598, "utc_time": "2025-04-09 08:23:14.071586"}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Se puede comprobar como ha habido comprobaci\xf3nes de intento de acceso al puerto ",(0,r.jsx)(n.strong,{children:"21"})," del servicio ",(0,r.jsx)(n.strong,{children:"FTP"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"comprobaci\xf3n-de-acceso-al-ftp-conectado-a-la-m\xe1quina-por-ssh",children:"Comprobaci\xf3n de acceso al ftp conectado a la m\xe1quina por SSH"}),"\n",(0,r.jsxs)(n.p,{children:["Otra prueba realizada consisten en conectarse por ",(0,r.jsx)(n.strong,{children:"SSH"})," al host que tiene instalado y configurado el ",(0,r.jsx)(n.strong,{children:"honeypot"})," e intentar establecer una conexi\xf3n ",(0,r.jsx)(n.strong,{children:"FTP"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"ftp 10.0.2.15\r\n\r\nConnected to 10.0.2.15.\r\n220 FTP server ready\r\nName (10.0.2.15:lite): lite\r\n331 Password required for lite.\r\nPassword: \r\n530 Sorry, Authentication failed.\r\nftp: Login failed\r\nftp> \r\nftp> exit\r\n221 Goodbye.\n"})}),"\n",(0,r.jsx)(n.h4,{id:"logs-de-dicho-intento-de-acceso-al-ftp",children:"Logs de dicho intento de acceso al FTP"}),"\n",(0,r.jsxs)(n.p,{children:["Despu\xe9s del intento de establecimiento de conexi\xf3n ",(0,r.jsx)(n.strong,{children:"FTP"})," consultando los ",(0,r.jsx)(n.strong,{children:"logs del honeypot"})," se puede comprobar los datos introducidos por el ",(0,r.jsx)(n.strong,{children:"atacante"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'{"dst_host": "10.0.2.15", "dst_port": 21, "local_time": "2025-04-09 08:28:20.855439", "local_time_adjusted": "2025-04-09 10:28:20.855478", "logdata": {"PASSWORD": "123456", "USERNAME": "lite"}, "logtype": 2000, "node_id": "opencanary-1", "src_host": "10.0.2.15", "src_port": 33896, "utc_time": "2025-04-09 08:28:20.855471"}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>c});var a=o(6540);const r={},i=a.createContext(r);function s(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);
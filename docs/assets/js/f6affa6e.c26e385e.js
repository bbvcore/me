"use strict";(self.webpackChunkmydocs=self.webpackChunkmydocs||[]).push([[2522],{1566:(e,i,a)=>{a.r(i),a.d(i,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"Ciberseguridad/ElasticStack/Despliegues/despliegue-dfir","title":"Despliegue Defir","description":"ElasticSearch","source":"@site/docs/Ciberseguridad/ElasticStack/Despliegues/despliegue-dfir.md","sourceDirName":"Ciberseguridad/ElasticStack/Despliegues","slug":"/Ciberseguridad/ElasticStack/Despliegues/despliegue-dfir","permalink":"/me/docs/docs/Ciberseguridad/ElasticStack/Despliegues/despliegue-dfir","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Ciberseguridad/ElasticStack/Despliegues/despliegue-dfir.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Despliegue Defir"},"sidebar":"tutorialSidebar","previous":{"title":"Fleet y Elastic Agent","permalink":"/me/docs/docs/Ciberseguridad/ElasticStack/fleet-agent"},"next":{"title":"Despliegue Hist_db","permalink":"/me/docs/docs/Ciberseguridad/ElasticStack/Despliegues/despliegue-hist_db"}}');var s=a(4848),l=a(8453);const r={sidebar_position:1,title:"Despliegue Defir"},t="Despliegue Defir",d={},c=[{value:"ElasticSearch",id:"elasticsearch",level:2},{value:"Actualizaci\xf3n del sistema",id:"actualizaci\xf3n-del-sistema",level:3},{value:"Instalaci\xf3n de Java",id:"instalaci\xf3n-de-java",level:3},{value:"Agregar repositorio",id:"agregar-repositorio",level:3},{value:"Descarga de la clave GPG",id:"descarga-de-la-clave-gpg",level:4},{value:"A\xf1adir repositorio firmado a sources.list.d",id:"a\xf1adir-repositorio-firmado-a-sourceslistd",level:4},{value:"Instalar elasticsearch",id:"instalar-elasticsearch",level:3},{value:"Habilitar servicio e inicalizaci\xf3n",id:"habilitar-servicio-e-inicalizaci\xf3n",level:3},{value:"Comprobar el estado del servicio",id:"comprobar-el-estado-del-servicio",level:3},{value:"Obtenci\xf3n del token para la instalaci\xf3n de Kibana",id:"obtenci\xf3n-del-token-para-la-instalaci\xf3n-de-kibana",level:3},{value:"Instalaci\xf3n de Kibana",id:"instalaci\xf3n-de-kibana",level:2},{value:"Actualizaci\xf3n e instalaci\xf3n",id:"actualizaci\xf3n-e-instalaci\xf3n",level:3},{value:"Habilitar Kibana",id:"habilitar-kibana",level:3},{value:"Introducir el Token",id:"introducir-el-token",level:3},{value:"Inicializar Kibana",id:"inicializar-kibana",level:3},{value:"Elastic Agent",id:"elastic-agent",level:2},{value:"Descarga del agente para Linux",id:"descarga-del-agente-para-linux",level:3},{value:"Descomprimir el agente",id:"descomprimir-el-agente",level:4},{value:"Instalaci\xf3n del agente",id:"instalaci\xf3n-del-agente",level:4},{value:"A\xf1adir integraci\xf3n Windows a Fleet",id:"a\xf1adir-integraci\xf3n-windows-a-fleet",level:2},{value:"Anexo: Preparaci\xf3n de Windows",id:"anexo-preparaci\xf3n-de-windows",level:3},{value:"Sysmon",id:"sysmon",level:4},{value:"Instalaci\xf3n del Agente",id:"instalaci\xf3n-del-agente-1",level:4}];function o(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.header,{children:(0,s.jsx)(i.h1,{id:"despliegue-defir",children:"Despliegue Defir"})}),"\n",(0,s.jsx)(i.h2,{id:"elasticsearch",children:"ElasticSearch"}),"\n",(0,s.jsx)(i.h3,{id:"actualizaci\xf3n-del-sistema",children:"Actualizaci\xf3n del sistema"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"sudo apt update && sudo apt upgrade -y\n"})}),"\n",(0,s.jsx)(i.h3,{id:"instalaci\xf3n-de-java",children:"Instalaci\xf3n de Java"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"sudo apt install openjdk-17-jdk -y\n"})}),"\n",(0,s.jsx)(i.h3,{id:"agregar-repositorio",children:"Agregar repositorio"}),"\n",(0,s.jsx)(i.h4,{id:"descarga-de-la-clave-gpg",children:"Descarga de la clave GPG"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo gpg --dearmor -o /usr/share/keyrings/elasticsearch-keyring.gpg\n"})}),"\n",(0,s.jsx)(i.h4,{id:"a\xf1adir-repositorio-firmado-a-sourceslistd",children:"A\xf1adir repositorio firmado a sources.list.d"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'echo "deb [signed-by=/usr/share/keyrings/elasticsearch-keyring.gpg] https://artifacts.elastic.co/packages/8.x/apt stable main" | sudo tee /etc/apt/sources.list.d/elastic-8.x.list\n'})}),"\n",(0,s.jsx)(i.h3,{id:"instalar-elasticsearch",children:"Instalar elasticsearch"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"sudo apt update\r\nsudo apt install elasticsearch -y\n"})}),"\n",(0,s.jsx)(i.h3,{id:"habilitar-servicio-e-inicalizaci\xf3n",children:"Habilitar servicio e inicalizaci\xf3n"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"sudo systemctl daemon-reexec\r\nsudo systemctl enable elasticsearch\r\nsudo systemctl start elasticsearch\n"})}),"\n",(0,s.jsx)(i.h3,{id:"comprobar-el-estado-del-servicio",children:"Comprobar el estado del servicio"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'sleep 10\r\nsudo apt install curl\r\ncurl -k https://localhost:9200 || echo "Puede estar todav\xeda inicializando el servicio elasticsearch."\n'})}),"\n",(0,s.jsx)(i.h3,{id:"obtenci\xf3n-del-token-para-la-instalaci\xf3n-de-kibana",children:"Obtenci\xf3n del token para la instalaci\xf3n de Kibana"}),"\n",(0,s.jsx)(i.p,{children:"La vigencia de este token es de 30 minutos"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"sudo /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana\n"})}),"\n",(0,s.jsx)(i.h2,{id:"instalaci\xf3n-de-kibana",children:"Instalaci\xf3n de Kibana"}),"\n",(0,s.jsx)(i.h3,{id:"actualizaci\xf3n-e-instalaci\xf3n",children:"Actualizaci\xf3n e instalaci\xf3n"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"sudo apt update && sudo apt install kibana -y\n"})}),"\n",(0,s.jsx)(i.h3,{id:"habilitar-kibana",children:"Habilitar Kibana"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"sudo systemctl enable kibana\n"})}),"\n",(0,s.jsx)(i.h3,{id:"introducir-el-token",children:"Introducir el Token"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'sudo /usr/share/kibana/bin/kibana-setup --enrollment-token "<pegar el token>"\n'})}),"\n",(0,s.jsx)(i.h3,{id:"inicializar-kibana",children:"Inicializar Kibana"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"sudo systemctl start kibana\n"})}),"\n",(0,s.jsx)(i.h2,{id:"elastic-agent",children:"Elastic Agent"}),"\n",(0,s.jsxs)(i.p,{children:["Accediendo a la secci\xf3n ",(0,s.jsx)(i.strong,{children:"Fleet"})," yendo a ",(0,s.jsx)(i.strong,{children:"Add Fleet Server"}),"."]}),"\n",(0,s.jsx)(i.admonition,{title:"Opciones al a\xf1adir el Fleet Server",type:"tip",children:(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Establecer un nombre."}),"\n",(0,s.jsxs)(i.li,{children:["A\xf1adir un host, normalmente: ",(0,s.jsx)(i.a,{href:"https://localhost:8220",children:"https://localhost:8220"})]}),"\n",(0,s.jsx)(i.li,{children:"Confirmar el nombre y el host."}),"\n",(0,s.jsxs)(i.li,{children:["Descargar e instalar el ",(0,s.jsx)(i.strong,{children:"Fleet Server"})," en el host Server\r\ndonde est\xe1 instalado ElasticSearch y Kibana. Revisar el c\xf3digo proporcionado y cambiar la IP por localhost de ser necesario."]}),"\n"]})}),"\n",(0,s.jsx)(i.h3,{id:"descarga-del-agente-para-linux",children:"Descarga del agente para Linux"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.13.4-linux-x86_64.tar.gz\n"})}),"\n",(0,s.jsx)(i.h4,{id:"descomprimir-el-agente",children:"Descomprimir el agente"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"tar -xzf elastic-agent-8.13.4-linux-x86_64.tar.gz\n"})}),"\n",(0,s.jsx)(i.h4,{id:"instalaci\xf3n-del-agente",children:"Instalaci\xf3n del agente"}),"\n",(0,s.jsx)(i.admonition,{type:"warning",children:(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"La opci\xf3n --insecure se usa para poder operar sin tener habilitados certificados TLS/SSL y aplicar solo el uso del Token para el enrollment."}),"\n"]})}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'sudo ./elastic-agent install \\\r\n  --url="URL con protocolo del Fleet Server: Puerto" \\\r\n  --enrollment-token="Token del enrollment" \\\r\n  --insecure\n'})}),"\n",(0,s.jsx)(i.h2,{id:"a\xf1adir-integraci\xf3n-windows-a-fleet",children:"A\xf1adir integraci\xf3n Windows a Fleet"}),"\n",(0,s.jsx)(i.p,{children:'Para poder monitorizar Windows mediante la instalaci\xf3n en ese sistema operativo de Sysmon se debe de agregar la integraci\xf3n de "Windows".'}),"\n",(0,s.jsx)(i.admonition,{title:"Pasos en la interfaz gr\xe1fica",type:"tip",children:(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Add integration"}),"\n",(0,s.jsx)(i.li,{children:'Buscar "Windows"'}),"\n",(0,s.jsxs)(i.li,{children:["Ir a ",(0,s.jsx)(i.strong,{children:"Settings"})," e ",(0,s.jsx)(i.strong,{children:"Install Windows"})," donde a\xf1ade 18 assets"]}),"\n",(0,s.jsx)(i.li,{children:"Add Windows"}),"\n",(0,s.jsx)(i.li,{children:"Save & continue"}),"\n"]})}),"\n",(0,s.jsx)(i.h3,{id:"anexo-preparaci\xf3n-de-windows",children:"Anexo: Preparaci\xf3n de Windows"}),"\n",(0,s.jsx)(i.h4,{id:"sysmon",children:"Sysmon"}),"\n",(0,s.jsx)(i.p,{children:"Desde la Web de Microsoft Learn se realiza la descarga de Sysmon, adem\xe1s tambi\xe9n se descarga SwiftOnSecurity para obtener el fichero XML de configuraci\xf3n."}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:".\\Sysmon -i --accepteua\r\n.\\Sysmon -c <fichero-configuracion.xml>\n"})}),"\n",(0,s.jsx)(i.h4,{id:"instalaci\xf3n-del-agente-1",children:"Instalaci\xf3n del Agente"}),"\n",(0,s.jsx)(i.p,{children:"Instalarlo como Administrador usando la Power Shell"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'.\\elastic-agent.exe install --url=Url Server: Puerto --enrollment-token=Enrollment Token --insecure"\n'})})]})}function h(e={}){const{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453:(e,i,a)=>{a.d(i,{R:()=>r,x:()=>t});var n=a(6540);const s={},l=n.createContext(s);function r(e){const i=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function t(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(l.Provider,{value:i},e.children)}}}]);
"use strict";(self.webpackChunkmydocs=self.webpackChunkmydocs||[]).push([[1957],{6791:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>d,contentTitle:()=>t,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"Ciberseguridad/Cortafuegos/iptables","title":"Iptables","description":"Principales par\xe1metros","source":"@site/docs/Ciberseguridad/Cortafuegos/iptables.md","sourceDirName":"Ciberseguridad/Cortafuegos","slug":"/Ciberseguridad/Cortafuegos/iptables","permalink":"/me/docs/docs/Ciberseguridad/Cortafuegos/iptables","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Ciberseguridad/Cortafuegos/iptables.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Iptables"},"sidebar":"tutorialSidebar","previous":{"title":"Firewall Windows Defender","permalink":"/me/docs/docs/Ciberseguridad/Cortafuegos/fw"},"next":{"title":"Netplan","permalink":"/me/docs/docs/Ciberseguridad/Cortafuegos/netplan"}}');var s=n(4848),r=n(8453);const l={sidebar_position:2,title:"Iptables"},t="Iptables",d={},o=[{value:"Principales par\xe1metros",id:"principales-par\xe1metros",level:2},{value:"Tablas b\xe1sicas:",id:"tablas-b\xe1sicas",level:2},{value:"Casos de uso",id:"casos-de-uso",level:2},{value:"Tabla Filter",id:"tabla-filter",level:3},{value:"Bloqueo de externa a interna",id:"bloqueo-de-externa-a-interna",level:4},{value:"Permitir solo tr\xe1fico de entrada por la interfaz externa",id:"permitir-solo-tr\xe1fico-de-entrada-por-la-interfaz-externa",level:4},{value:"Impedir acceso de una m\xe1quina local a otra",id:"impedir-acceso-de-una-m\xe1quina-local-a-otra",level:4},{value:"Tabla NAT: redirecci\xf3n de la red interna (DNAT,SNAT,MASQUERADE)",id:"tabla-nat-redirecci\xf3n-de-la-red-interna-dnatsnatmasquerade",level:3},{value:"Conexiones entrantes",id:"conexiones-entrantes",level:4},{value:"Ocultar la Ip privada",id:"ocultar-la-ip-privada",level:4},{value:"Tabla MANGLE: gestiona cabeceras",id:"tabla-mangle-gestiona-cabeceras",level:3},{value:"Tabla RAW: gestiona conexiones",id:"tabla-raw-gestiona-conexiones",level:3},{value:"Evitar el seguimiento de conexi\xf3n",id:"evitar-el-seguimiento-de-conexi\xf3n",level:4},{value:"Seguir conexiones",id:"seguir-conexiones",level:4},{value:"Desactivar seguimiento de todas las conexiones",id:"desactivar-seguimiento-de-todas-las-conexiones",level:3},{value:"Reactivar el seguimiento  de todas las conexiones",id:"reactivar-el-seguimiento--de-todas-las-conexiones",level:3}];function c(e){const a={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.header,{children:(0,s.jsx)(a.h1,{id:"iptables",children:"Iptables"})}),"\n",(0,s.jsx)(a.h2,{id:"principales-par\xe1metros",children:"Principales par\xe1metros"}),"\n",(0,s.jsx)(a.p,{children:"-L\n-S\n-F\n-A\n-D\n-J\n-v\n-n\n--line-number\n-t"}),"\n",(0,s.jsx)(a.h2,{id:"tablas-b\xe1sicas",children:"Tablas b\xe1sicas:"}),"\n",(0,s.jsxs)("table",{border:"1",children:[(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Tabla"}),(0,s.jsx)("th",{children:"Uso"}),(0,s.jsx)("th",{children:"Cadenas Admitidas"})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:"Filter"}),(0,s.jsx)("td",{children:"Realiza el filtrado de paquetes, permitiendo o denegando el acceso. (tabla por defecto)"}),(0,s.jsx)("td",{children:"INPUT, FORWARD, OUTPUT"})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:"Nat"}),(0,s.jsx)("td",{children:"Realiza la traducci\xf3n de direcciones de red, modificando la direcci\xf3n de los paquetes (DNAT, SNAT, Masquerade)"}),(0,s.jsx)("td",{children:"PREROUTING, OUTPUT, POSTROUTING"})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:"Mangle"}),(0,s.jsx)("td",{children:"Realiza la modificaci\xf3n de la cabecera de los paquetes (ToS, TTL, QoS, etc.)"}),(0,s.jsx)("td",{children:"PREROUTING, INPUT, FORWARD, OUTPUT, POSTROUTING"})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:"Raw"}),(0,s.jsx)("td",{children:"Realiza el seguimiento y exclusi\xf3n del seguimiento de conexiones"}),(0,s.jsx)("td",{children:"PREROUTING, OUTPUT"})]})]}),"\n",(0,s.jsx)(a.h2,{id:"casos-de-uso",children:"Casos de uso"}),"\n",(0,s.jsx)(a.h3,{id:"tabla-filter",children:"Tabla Filter"}),"\n",(0,s.jsx)(a.p,{children:"Realizando la comunicaci\xf3n entre una red interna y un red externa."}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["La red interna corresponde a una de ",(0,s.jsx)(a.strong,{children:"clase C"})," y utiliza la interfaz ",(0,s.jsx)(a.strong,{children:"eth0"}),"."]}),"\n",(0,s.jsxs)(a.li,{children:["La red externa corresponde a una de ",(0,s.jsx)(a.strong,{children:"clase A"})," y utiliza la interfaz ",(0,s.jsx)(a.strong,{children:"eth1"}),"."]}),"\n"]}),"\n",(0,s.jsx)(a.h4,{id:"bloqueo-de-externa-a-interna",children:"Bloqueo de externa a interna"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"iptables -A FORWARD -i eth1 -o eth0 -j DROP \n"})}),"\n",(0,s.jsx)(a.h4,{id:"permitir-solo-tr\xe1fico-de-entrada-por-la-interfaz-externa",children:"Permitir solo tr\xe1fico de entrada por la interfaz externa"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"iptables -A FORWARD -i eth1 -o eth0 -p tcp --dport 22 -d 192.168.1.100 -j ACCEPT\n"})}),"\n",(0,s.jsx)(a.h4,{id:"impedir-acceso-de-una-m\xe1quina-local-a-otra",children:"Impedir acceso de una m\xe1quina local a otra"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"iptables -A INPUT -s 192.168.1.4 -d 192.168.1.5 -p icmp -j DROP\niptables -A INPUT -s 192.168.1.5 -d 192.168.1.4 -p icmp -j DROP\n"})}),"\n",(0,s.jsx)(a.h3,{id:"tabla-nat-redirecci\xf3n-de-la-red-interna-dnatsnatmasquerade",children:"Tabla NAT: redirecci\xf3n de la red interna (DNAT,SNAT,MASQUERADE)"}),"\n",(0,s.jsx)(a.h4,{id:"conexiones-entrantes",children:"Conexiones entrantes"}),"\n",(0,s.jsx)(a.p,{children:"Dirigidas al puerto 8080 de la IP escogida en la red local"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"iptables -t NAT -A PREROUTING -p tcp --dport 8080 -j DNAT --to-destination IpLocal:80\n"})}),"\n",(0,s.jsx)(a.h4,{id:"ocultar-la-ip-privada",children:"Ocultar la Ip privada"}),"\n",(0,s.jsxs)(a.p,{children:["Los paquetes salen con la ",(0,s.jsx)(a.strong,{children:"IP"})," p\xfablica del servidor, por ",(0,s.jsx)(a.strong,{children:"eth0"})," hac\xeda internet y por la ",(0,s.jsx)(a.strong,{children:"eth1"})," hac\xeda la red interna."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"iptables -t NAT -A POSTROUTING -o eht0 -j MASQUERADE\n"})}),"\n",(0,s.jsx)(a.p,{children:"Redirigir el tr\xe1fico de salida de toda la red local por una IP, es decir el origen es toda la red y el destino la interfaz de salida."}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:"s: source, 192.168.1.0/24"}),"\n",(0,s.jsx)(a.li,{children:"o: eth0, interfaz de salida"}),"\n"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:'iptables -t NAT -A POSTROUTING -s 192.168.1.0/24 -o eth0 -j SNAT --to-source "IP de salida a internet (10.0.0.1)"\n'})}),"\n",(0,s.jsx)(a.p,{children:"Redireccion de tr\xe1fico HTTP de la m\xe1quina local a un proxy, salida del puerto  80/tcp al puerto 3232 (proxy)"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"iptables -t NAT -A OUTPUT -p tcp --dport 80 -j REDIRECT --to-port 3232\n"})}),"\n",(0,s.jsx)(a.h3,{id:"tabla-mangle-gestiona-cabeceras",children:"Tabla MANGLE: gestiona cabeceras"}),"\n",(0,s.jsx)(a.p,{children:"Duplicar el tr\xe1fico de un equipo con server web a otro equipo de la misma red"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"iptables -t mangle -A PREROUTING -s serverLocalWebIp -p tcp --dport 80 -j TEE -gateway IPotroequipoRed\niptables -t mangle -A PREROUTING -d serverLocalWebIp -p tcp --sport 80 -j TEE -gateway IPotroequipoRed\n"})}),"\n",(0,s.jsx)(a.h3,{id:"tabla-raw-gestiona-conexiones",children:"Tabla RAW: gestiona conexiones"}),"\n",(0,s.jsx)(a.h4,{id:"evitar-el-seguimiento-de-conexi\xf3n",children:"Evitar el seguimiento de conexi\xf3n"}),"\n",(0,s.jsx)(a.p,{children:"Todo el tr\xe1fico que llegue al 80 no se debe de seguir (NOTRACK)"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"iptables -t raw PREROUTING -p tcp --dport 80 -j NOTRACK \n"})}),"\n",(0,s.jsx)(a.h4,{id:"seguir-conexiones",children:"Seguir conexiones"}),"\n",(0,s.jsx)(a.p,{children:"Se siguen las conexiones para udp 53 (DNS)"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"iptables -t raw -A PREROUTING -p udp --dport 53 -j CT --notrack\n"})}),"\n",(0,s.jsx)(a.h3,{id:"desactivar-seguimiento-de-todas-las-conexiones",children:"Desactivar seguimiento de todas las conexiones"}),"\n",(0,s.jsx)(a.p,{children:"Para as\xed evitar la sobrecarga de la red"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"iptables -t raw -A PREROUTING -j NOTRACK\n"})}),"\n",(0,s.jsx)(a.h3,{id:"reactivar-el-seguimiento--de-todas-las-conexiones",children:"Reactivar el seguimiento  de todas las conexiones"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"iptables -t raw -A POSTROUTING -j CT --track\n"})}),"\n",(0,s.jsx)(a.admonition,{title:"[]",type:"tip",children:(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"NOTRACK"})," y ",(0,s.jsx)(a.strong,{children:"-j CT --no-track"}),", hacen lo mismo, uno es la versi\xf3n m\xe1s antigua y otro la m\xe1s actual. Simplemente son dos formas de hacer lo mismo."]})})]})}function p(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,a,n)=>{n.d(a,{R:()=>l,x:()=>t});var i=n(6540);const s={},r=i.createContext(s);function l(e){const a=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function t(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(r.Provider,{value:a},e.children)}}}]);